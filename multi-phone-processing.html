
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Multi-phone localization &#8212; bioacoustics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'multi-phone-processing';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">bioacoustics</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Bioacoustics by WMXZ
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">General Bioacoustics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="wave_equation.html">Wave equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Zc_click.html">Cuvierâ€™s beaked whale click</a></li>
<li class="toctree-l1"><a class="reference internal" href="power_spectra.html">Spectral estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sound_intensity.html">Sound Intensity</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Processing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="transient_detection.html">Transient detections</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi-phone-localization.html">Multi-phone localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="beamforming.html">Beamforming</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi-channel-processing.html">Multi channel processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="ray_tracing.html">Ray tracing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">cVAS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="cVAS_direction.html">Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="cVAS_phase_direction.html">cVAS phase direction finding</a></li>
<li class="toctree-l1"><a class="reference internal" href="cVAS_stft_direction.html">cVAS stft direction finding</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Work in Progress</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Click_train_detector.html">Click train detector</a></li>
<li class="toctree-l1"><a class="reference internal" href="Detections.html">Click detection</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Bar La Mare</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="BLM/blm_0.html">BML_0: BAR_LA_MARE</a></li>
<li class="toctree-l1"><a class="reference internal" href="BLM/blm_1.html">BLM_1: Basic signal spectral analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="BLM/blm_2.html">BLM_2:  Wave propagation</a></li>
<li class="toctree-l1"><a class="reference internal" href="BLM/blm_3.html">BLM_3: Underwater Sound Propagation</a></li>
<li class="toctree-l1"><a class="reference internal" href="BLM/blm_4.html">BLM_4: Spectrogram</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/wmxz-eu/wmxz-eu.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/wmxz-eu/wmxz-eu.github.io/issues/new?title=Issue%20on%20page%20%2Fmulti-phone-processing.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/multi-phone-processing.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Multi-phone localization</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sound-source-distance">Sound source distance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#system-of-equations">System of equations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pseudo-inverse">Pseudo inverse</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#source-location-and-range-estimation">Source location and range estimation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#quadratic-equation">Quadratic equation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#localization-with-five-or-more-hydrophones">Localization with five or more hydrophones</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-1">method 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-2">method 2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#four-hydrophone-localization">Four-hydrophone localization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#three-hydrophone-localization">Three-hydrophone localization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-hydrophone-localization">Two-hydrophone localization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direction-finding">Direction finding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-phone-direction-finding">Multi-phone direction finding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#four-phone-direction-finding">Four-phone direction finding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#three-phone-direction-finding">Three-phone direction finding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beamforming">Beamforming</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-formulation-of-single-source-direction-finding">Basic formulation of single source direction finding</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#line-array">Line array</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-formulation-of-beamforming">Basic formulation of beamforming</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation">Simulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-measurements">Simulate measurements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-steering">check steering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-filtering-beamformer">Spatial filtering (beamformer)</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="multi-phone-localization">
<h1>Multi-phone localization<a class="headerlink" href="#multi-phone-localization" title="Link to this heading">#</a></h1>
<section id="sound-source-distance">
<h2>Sound source distance<a class="headerlink" href="#sound-source-distance" title="Link to this heading">#</a></h2>
<p>Let the location of hydrophone <span class="math notranslate nohighlight">\(i\)</span> be <span class="math notranslate nohighlight">\(h_i = (x_i,y_i.z_i)\)</span> and the source location be <span class="math notranslate nohighlight">\(s=(s_x,s_y,s_z)\)</span> then the distance of the source from the hydrophone is related by</p>
<div class="amsmath math notranslate nohighlight" id="equation-78dd97f4-08e1-43da-9cf0-1be2cbe94ca0">
<span class="eqno">()<a class="headerlink" href="#equation-78dd97f4-08e1-43da-9cf0-1be2cbe94ca0" title="Permalink to this equation">#</a></span>\[\begin{equation} \tag{*}
R_i^2=(s_x-x_i)^2+(s_y-y_i)^2+(s_z-z_i)^2
\end{equation}\]</div>
<p>which becomes</p>
<div class="amsmath math notranslate nohighlight" id="equation-4fcb9fa4-5ed2-4cfe-a934-cf4b3e3780a1">
<span class="eqno">()<a class="headerlink" href="#equation-4fcb9fa4-5ed2-4cfe-a934-cf4b3e3780a1" title="Permalink to this equation">#</a></span>\[\begin{equation} \tag{*}
R_i^2=(s_x^2+s_y^2+s_z^2)+(x_i^2+y_i^2+z_i^2) -2s_x x_i -2s_y y_i -2s_z z_i
\end{equation}\]</div>
<p>or in short</p>
<div class="amsmath math notranslate nohighlight" id="equation-138c4152-3340-48ee-9d0a-377c78580374">
<span class="eqno">()<a class="headerlink" href="#equation-138c4152-3340-48ee-9d0a-377c78580374" title="Permalink to this equation">#</a></span>\[\begin{equation}
R_i^2=|s|^2+|h_i|^2-2h_i^Ts
\end{equation}\]</div>
<p>Having more then 1 hydrophone, then for any pair of hydrophones <span class="math notranslate nohighlight">\((h_i, h_j)\)</span> one can form the difference obtaining</p>
<div class="amsmath math notranslate nohighlight" id="equation-a39ab96c-2b06-43ea-9d1c-95ed64eabd2d">
<span class="eqno">()<a class="headerlink" href="#equation-a39ab96c-2b06-43ea-9d1c-95ed64eabd2d" title="Permalink to this equation">#</a></span>\[\begin{equation}
R_i^2-R_j^2=|h_i|^2-|h_j|^2-2(h_i-h_j)^Ts
\end{equation}\]</div>
<p>Noting that <span class="math notranslate nohighlight">\(R_i^2-R_j^2=(R_j+(\delta R_{ij}))^2-R_j^2 = 2(\delta R_{ij})R_j+(\delta R_{ij})^2 \)</span></p>
<p>one gets the linear equation</p>
<div class="amsmath math notranslate nohighlight" id="equation-73fc35b1-90f8-48f6-bd47-a9d94a30711f">
<span class="eqno">()<a class="headerlink" href="#equation-73fc35b1-90f8-48f6-bd47-a9d94a30711f" title="Permalink to this equation">#</a></span>\[\begin{equation}
2(\delta R_{ij})R_j+(\delta R_{ij})^2=|h_i|^2-|h_j|^2-2(h_i-h_j)^Ts
\end{equation}\]</div>
<p>or, by putting the unknown source location to the left side and dividing by 2</p>
<div class="amsmath math notranslate nohighlight" id="equation-1ead0373-5bb1-4ffe-801f-ca0d930b3ef4">
<span class="eqno">()<a class="headerlink" href="#equation-1ead0373-5bb1-4ffe-801f-ca0d930b3ef4" title="Permalink to this equation">#</a></span>\[\begin{equation}
(h_i-h_j)^Ts=\frac{|h_i|^2-|h_j|^2-(\delta R_{ij})^2}{2}-(\delta R_{ij})R_j
\end{equation}\]</div>
<section id="system-of-equations">
<h3>System of equations<a class="headerlink" href="#system-of-equations" title="Link to this heading">#</a></h3>
<p>Let the number of hydrophones be <span class="math notranslate nohighlight">\(n+1\)</span> then one gets <span class="math notranslate nohighlight">\(n\)</span> equations</p>
<div class="amsmath math notranslate nohighlight" id="equation-a2d8954f-3df7-4c5c-9b56-68798a98aee4">
<span class="eqno">()<a class="headerlink" href="#equation-a2d8954f-3df7-4c5c-9b56-68798a98aee4" title="Permalink to this equation">#</a></span>\[\begin{equation}
\left(\begin{matrix}(x_1-x_0)&amp;(y_1-y_0)&amp;(z_1-z_0)\\\vdots&amp;\vdots&amp;\vdots\\(x_n-x_0)&amp;(y_n-y_0)&amp;(z_n-z_0)\end{matrix}\right)s
=\frac{1}{2}
\left(\begin{matrix}|h_1|^2-|h_0|^2-(\delta R_{10})^2\\\vdots\\|h_n|^2-|h_0|^2-(\delta R_{n0})^2\end{matrix}\right)
-\left(\begin{matrix}\delta R_{10}\\\vdots\\\delta R_{n0}\end{matrix}\right)R_0
\end{equation}\]</div>
<p>or in matrix notation</p>
<div class="amsmath math notranslate nohighlight" id="equation-751f60b1-44d5-4be6-95e3-a58b46a926e4">
<span class="eqno">()<a class="headerlink" href="#equation-751f60b1-44d5-4be6-95e3-a58b46a926e4" title="Permalink to this equation">#</a></span>\[\begin{equation}
As=b_0-b_1R_0
\end{equation}\]</div>
<p>whereby</p>
<div class="amsmath math notranslate nohighlight" id="equation-308e7309-c256-4b48-a478-837c79f7acb2">
<span class="eqno">()<a class="headerlink" href="#equation-308e7309-c256-4b48-a478-837c79f7acb2" title="Permalink to this equation">#</a></span>\[\begin{equation}
A=\left(\begin{matrix}(x_1-x_0)&amp;(y_1-y_0)&amp;(z_1-z_0)\\\vdots&amp;\vdots&amp;\vdots\\(x_n-x_0)&amp;(y_n-y_0)&amp;(z_n-z_0)\end{matrix}\right)
\end{equation}\]</div>
<div class="amsmath math notranslate nohighlight" id="equation-e47ef2fb-cfc6-4977-b958-5ea6b45a5609">
<span class="eqno">()<a class="headerlink" href="#equation-e47ef2fb-cfc6-4977-b958-5ea6b45a5609" title="Permalink to this equation">#</a></span>\[\begin{equation}
b_0=\frac{1}{2}
\left(\begin{matrix}|h_1|^2-|h_0|^2-(\delta R_{10})^2\\\vdots\\|h_n|^2-|h_0|^2-(\delta R_{n0})^2\end{matrix}\right)
\end{equation}\]</div>
<div class="amsmath math notranslate nohighlight" id="equation-757b62a8-3f87-4ab6-be80-dcdf13fc26ef">
<span class="eqno">()<a class="headerlink" href="#equation-757b62a8-3f87-4ab6-be80-dcdf13fc26ef" title="Permalink to this equation">#</a></span>\[\begin{equation}
b_1=\left(\begin{matrix}\delta R_{10}\\\vdots\\\delta R_{n0}\end{matrix}\right)
\end{equation}\]</div>
</section>
<section id="pseudo-inverse">
<h3>Pseudo inverse<a class="headerlink" href="#pseudo-inverse" title="Link to this heading">#</a></h3>
<p>A system of equations for three unknows <span class="math notranslate nohighlight">\(s=(s_x,s_y,s_z)\)</span> cannot be solved without additional constraints if the number of independent equations is different of three. The additional constraint, whicht is typically assumed is that the vector norm <span class="math notranslate nohighlight">\(||s|| \to \min\)</span> that leads to the (Penrose) pseudo inverse <span class="math notranslate nohighlight">\(A^+\)</span></p>
<p>Definintion of pseudo inverse <span class="math notranslate nohighlight">\(A^+\)</span></p>
<div class="amsmath math notranslate nohighlight" id="equation-8a532d8b-67aa-4756-8160-2860936d64ad">
<span class="eqno">()<a class="headerlink" href="#equation-8a532d8b-67aa-4756-8160-2860936d64ad" title="Permalink to this equation">#</a></span>\[\begin{equation}
    A A^+ A = A
\end{equation}\]</div>
<p>For an underdetermined system, i.e. number of equation &lt; number of unknows, or rank of matrix <span class="math notranslate nohighlight">\(A\)</span> &lt; numbers of unknown, the pseudo inverse is given by</p>
<div class="amsmath math notranslate nohighlight" id="equation-b8b5e03b-343c-442f-84a8-d7efa8f7788d">
<span class="eqno">()<a class="headerlink" href="#equation-b8b5e03b-343c-442f-84a8-d7efa8f7788d" title="Permalink to this equation">#</a></span>\[\begin{equation}
    A^+ = A^T(AA^T)^{-1}
\end{equation}\]</div>
<p>For an overdetermined system, i.e. number of equation &gt; number of unknows, or rank of matrix <span class="math notranslate nohighlight">\(A\)</span> &lt; numbers of equations, the pseudo inverse is given by</p>
<div class="amsmath math notranslate nohighlight" id="equation-3005f5d4-edc6-483e-adc3-8a2dc664483f">
<span class="eqno">()<a class="headerlink" href="#equation-3005f5d4-edc6-483e-adc3-8a2dc664483f" title="Permalink to this equation">#</a></span>\[\begin{equation}
    A^+ = (A^TA)^{-1}A^T
\end{equation}\]</div>
<p>which is the classical least mean square (LMS) fit</p>
</section>
<section id="source-location-and-range-estimation">
<h3>Source location and range estimation<a class="headerlink" href="#source-location-and-range-estimation" title="Link to this heading">#</a></h3>
<p>With</p>
<div class="amsmath math notranslate nohighlight" id="equation-24305513-bc19-4ab5-80aa-b76c43b2655f">
<span class="eqno">()<a class="headerlink" href="#equation-24305513-bc19-4ab5-80aa-b76c43b2655f" title="Permalink to this equation">#</a></span>\[\begin{align}
u_0 =&amp; A^+ b_0\\
u_1 =&amp; A^+ b_1
\end{align}\]</div>
<p>the source vector becomes</p>
<div class="amsmath math notranslate nohighlight" id="equation-04d64e64-6b28-4636-8d1e-09d45697f61e">
<span class="eqno">()<a class="headerlink" href="#equation-04d64e64-6b28-4636-8d1e-09d45697f61e" title="Permalink to this equation">#</a></span>\[\begin{equation}
s=u_0-u_1R_0
\end{equation}\]</div>
<p>Knowing that</p>
<div class="amsmath math notranslate nohighlight" id="equation-f60d2766-f2b4-4344-9060-d6c7acc86b3a">
<span class="eqno">()<a class="headerlink" href="#equation-f60d2766-f2b4-4344-9060-d6c7acc86b3a" title="Permalink to this equation">#</a></span>\[\begin{equation}
R_0^2=|s-h_0|^2=|u_0-h_0-u_1R_0|^2
\end{equation}\]</div>
<p>or</p>
<div class="amsmath math notranslate nohighlight" id="equation-cf124e80-e192-4c92-92f8-2010aa19fae0">
<span class="eqno">()<a class="headerlink" href="#equation-cf124e80-e192-4c92-92f8-2010aa19fae0" title="Permalink to this equation">#</a></span>\[\begin{equation}
R_0^2=|u_0-h_0|^2-2(u_0-h_0)^Tu_1R_0 + |u_1|^2R_0^2
\end{equation}\]</div>
<p>one obtains a quadratic equation in <span class="math notranslate nohighlight">\(R_0\)</span></p>
<div class="amsmath math notranslate nohighlight" id="equation-2aa8fcd7-381d-48b6-9079-a8e8024c1d3c">
<span class="eqno">()<a class="headerlink" href="#equation-2aa8fcd7-381d-48b6-9079-a8e8024c1d3c" title="Permalink to this equation">#</a></span>\[\begin{equation}
(|u_1|^2-1)R_0^2 -2(u_0-h_0)^Tu_1R_0 +|u_0-h_0|^2=0
\end{equation}\]</div>
<section id="quadratic-equation">
<h4>Quadratic equation<a class="headerlink" href="#quadratic-equation" title="Link to this heading">#</a></h4>
<p>For a quadratic equation</p>
<div class="amsmath math notranslate nohighlight" id="equation-56743b43-6fa4-460a-8df5-2e80d362d21e">
<span class="eqno">()<a class="headerlink" href="#equation-56743b43-6fa4-460a-8df5-2e80d362d21e" title="Permalink to this equation">#</a></span>\[\begin{equation}
ax^2+bx+c=0
\end{equation}\]</div>
<p>the solution is known to be</p>
<div class="amsmath math notranslate nohighlight" id="equation-a9cf55e5-e7f2-444f-982f-77d2c8e398b1">
<span class="eqno">()<a class="headerlink" href="#equation-a9cf55e5-e7f2-444f-982f-77d2c8e398b1" title="Permalink to this equation">#</a></span>\[\begin{equation}
x=\frac{-b\pm\sqrt{b^2-4ac}}{2a}
\end{equation}\]</div>
<p>To apply the solution of a quadratic equation one defines</p>
<div class="amsmath math notranslate nohighlight" id="equation-6125fc4b-0f3e-4a50-915e-a5633c7fe952">
<span class="eqno">()<a class="headerlink" href="#equation-6125fc4b-0f3e-4a50-915e-a5633c7fe952" title="Permalink to this equation">#</a></span>\[\begin{equation}
a=(|u_1|^2-1)
\end{equation}\]</div>
<div class="amsmath math notranslate nohighlight" id="equation-97d8c5f8-0f12-4198-81b7-f63fa294c883">
<span class="eqno">()<a class="headerlink" href="#equation-97d8c5f8-0f12-4198-81b7-f63fa294c883" title="Permalink to this equation">#</a></span>\[\begin{equation}
b=-2(u_0-h_0)^Tu_1
\end{equation}\]</div>
<div class="amsmath math notranslate nohighlight" id="equation-02058778-4a99-4764-89ed-6d9f46a5a73f">
<span class="eqno">()<a class="headerlink" href="#equation-02058778-4a99-4764-89ed-6d9f46a5a73f" title="Permalink to this equation">#</a></span>\[\begin{equation}
c=|u_0-h_0|^2
\end{equation}\]</div>
</section>
</section>
</section>
<section id="localization-with-five-or-more-hydrophones">
<h2>Localization with five or more hydrophones<a class="headerlink" href="#localization-with-five-or-more-hydrophones" title="Link to this heading">#</a></h2>
<p>Five or more hydrophones allow at least 4 hydrophone pairs that in matrix notation are written as</p>
<section id="method-1">
<h3>method 1<a class="headerlink" href="#method-1" title="Link to this heading">#</a></h3>
<p>Let the number of hydrophones be <span class="math notranslate nohighlight">\(n+1\)</span> then one gets <span class="math notranslate nohighlight">\(n\)</span> equations</p>
<div class="amsmath math notranslate nohighlight" id="equation-60443874-7576-46c7-a4df-76f49712a521">
<span class="eqno">()<a class="headerlink" href="#equation-60443874-7576-46c7-a4df-76f49712a521" title="Permalink to this equation">#</a></span>\[\begin{equation}
\left(\begin{matrix}(x_1-x_0)&amp;(y_1-y_0)&amp;(z_1-z_0)\\\vdots&amp;\vdots&amp;\vdots\\(x_n-x_0)&amp;(y_n-y_0)&amp;(z_n-z_0)\end{matrix}\right)s
=\frac{1}{2}
\left(\begin{matrix}|h_1|^2-|h_0|^2-(\delta R_{10})^2\\\vdots\\|h_n|^2-|h_0|^2-(\delta R_{n0})^2\end{matrix}\right)
-\left(\begin{matrix}\delta R_{10}\\\vdots\\\delta R_{n0}\end{matrix}\right)R_0
\end{equation}\]</div>
<p>that again transforms to a vector</p>
<div class="amsmath math notranslate nohighlight" id="equation-7a767c9f-2c04-4f9b-b10a-affc55a2dc13">
<span class="eqno">()<a class="headerlink" href="#equation-7a767c9f-2c04-4f9b-b10a-affc55a2dc13" title="Permalink to this equation">#</a></span>\[\begin{equation}
s=u_0 - u_1R_0
\end{equation}\]</div>
<p>with</p>
<div class="amsmath math notranslate nohighlight" id="equation-4d94c562-ca37-4b98-8fbe-004a877aa066">
<span class="eqno">()<a class="headerlink" href="#equation-4d94c562-ca37-4b98-8fbe-004a877aa066" title="Permalink to this equation">#</a></span>\[\begin{align}
u_0=&amp;A^+b_0\\
u_1=&amp;A^+b_1
\end{align}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># five hydrophones</span>
<span class="c1"># method 1</span>
<span class="n">h</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span>
<span class="n">D</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span><span class="o">-</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">DI</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>

<span class="c1">#simulasted whale location</span>
<span class="n">w</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># whale directions from hydrophone</span>
<span class="n">D</span><span class="o">=</span><span class="n">w</span><span class="o">-</span><span class="n">h</span>
<span class="c1"># slant ranges</span>
<span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">D</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># for selecting hydrophone pairs</span>
<span class="n">im1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="n">im0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#</span>
<span class="c1"># simulated path differences</span>
<span class="n">DR</span><span class="o">=</span><span class="n">R</span><span class="p">[</span><span class="n">im1</span><span class="p">]</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="n">im0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">direction</span><span class="p">(</span><span class="n">DI</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">im1</span><span class="p">,</span><span class="n">im0</span><span class="p">,</span><span class="n">DR</span><span class="p">):</span>
    <span class="c1"># estimation method 1</span>
    <span class="n">b0</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">im1</span><span class="p">,:]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">im0</span><span class="p">,:]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">DR</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">b1</span><span class="o">=</span><span class="n">DR</span>

    <span class="n">u0</span><span class="o">=</span><span class="p">(</span><span class="n">DI</span><span class="nd">@b0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">u1</span><span class="o">=</span><span class="p">(</span><span class="n">DI</span><span class="nd">@b1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># direction estimation</span>
    <span class="n">az</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">u1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="o">-</span><span class="n">u1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">el</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">u1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">u1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">return</span> <span class="n">u0</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">az</span><span class="p">,</span><span class="n">el</span>

<span class="n">u0</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">az</span><span class="p">,</span><span class="n">el</span><span class="o">=</span><span class="n">direction</span><span class="p">(</span><span class="n">DI</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">im1</span><span class="p">,</span><span class="n">im0</span><span class="p">,</span><span class="n">DR</span><span class="p">)</span>
<span class="c1"># check with simulation</span>
<span class="n">z</span><span class="o">=</span><span class="n">w</span><span class="o">-</span><span class="n">u0</span><span class="o">.</span><span class="n">T</span>
<span class="n">z1</span><span class="o">=</span><span class="n">z</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">azo</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">elo</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z:&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;u1:&#39;</span><span class="p">,</span><span class="n">u1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;az:&#39;</span><span class="p">,</span><span class="n">az</span><span class="p">,</span> <span class="s1">&#39;el:&#39;</span><span class="p">,</span><span class="n">el</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;azo:&#39;</span><span class="p">,</span><span class="n">azo</span><span class="p">,</span><span class="s1">&#39;elo:&#39;</span><span class="p">,</span><span class="n">elo</span><span class="p">)</span>

<span class="c1"># range estimation</span>
<span class="k">def</span> <span class="nf">rangeEstimation</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">h</span><span class="p">):</span>
    <span class="n">h0</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">aa</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">bb</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">u0</span><span class="o">-</span><span class="n">h0</span><span class="p">)</span><span class="o">*</span><span class="n">u1</span><span class="p">)</span>
    <span class="n">cc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">u0</span><span class="o">-</span><span class="n">h0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">r0</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">bb</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bb</span><span class="o">*</span><span class="n">bb</span><span class="o">-</span><span class="n">aa</span><span class="o">*</span><span class="n">cc</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
    <span class="n">S</span><span class="o">=</span><span class="p">(</span><span class="n">u0</span><span class="o">-</span><span class="n">u1</span><span class="o">*</span><span class="n">r0</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">S</span><span class="p">,</span><span class="n">r0</span>

<span class="n">S</span><span class="p">,</span><span class="n">r0</span><span class="o">=</span><span class="n">rangeEstimation</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;S:&#39;</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="s1">&#39;r0:&#39;</span><span class="p">,</span><span class="n">r0</span><span class="p">)</span>

<span class="c1"># to visualize direction</span>
<span class="n">rr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">vv</span><span class="o">=</span><span class="n">u0</span><span class="o">-</span><span class="n">u1</span><span class="o">*</span><span class="n">rr</span>

<span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">u0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">u0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">vv</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>z: [[-0.9614814  -0.06958701  0.93023403]]
u1: [[ 0.08777084  0.0063524  -0.08491836]]
az: [-175.86044785] el: [43.9788835]
azo: -175.8604478533724 elo: 43.97888350072386
S: [ 4. 10.  2.] r0: 10.95445115010333
</pre></div>
</div>
<img alt="_images/6e13043b53c699a18ef94a186f5cc87995a8b60e9dcec56268f2d4d659a8e1a2.png" src="_images/6e13043b53c699a18ef94a186f5cc87995a8b60e9dcec56268f2d4d659a8e1a2.png" />
</div>
</div>
</section>
<section id="method-2">
<h3>method 2<a class="headerlink" href="#method-2" title="Link to this heading">#</a></h3>
<p>Let the number of hydrophones be again <span class="math notranslate nohighlight">\(n+1\)</span> then one gets <span class="math notranslate nohighlight">\(n\)</span> equations</p>
<div class="amsmath math notranslate nohighlight" id="equation-f938abfa-29f2-40e0-a578-de2d613e444c">
<span class="eqno">()<a class="headerlink" href="#equation-f938abfa-29f2-40e0-a578-de2d613e444c" title="Permalink to this equation">#</a></span>\[\begin{equation}
\left(\begin{matrix}\delta R_{10}&amp;(x_1-x_0)&amp;(y_1-y_0)&amp;(z_1-z_0)\\\vdots&amp;\vdots&amp;\vdots&amp;\vdots\\\delta R_{n0}&amp;(x_n-x_0)&amp;(y_n-y_0)&amp;(z_n-z_0)\end{matrix}\right)\left(\begin{matrix}R_0\\s_y\\s_y\\s_z\end{matrix}\right)
=\frac{1}{2}
\left(\begin{matrix}|h_1|^2-|h_0|^2-(\delta R_{10})^2\\\vdots\\|h_n|^2-|h_0|^2-(\delta R_{n0})^2\end{matrix}\right)
\end{equation}\]</div>
<p>The solution of which using the LMS pseudo inverse gives directly the source co-ordinates and the source range from the reference hydrophone</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># five hydrophones</span>
<span class="c1"># method 2</span>
<span class="n">h</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span>

<span class="c1">#simulasted whale location</span>
<span class="n">w</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># whale directions from hydrophones</span>
<span class="n">RX</span><span class="o">=</span><span class="n">w</span><span class="o">-</span><span class="n">h</span>
<span class="c1"># slant ranges</span>
<span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RX</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># for selecting hydrophone pairs</span>
<span class="n">im1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="n">im0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#</span>
<span class="c1"># simulated path differences</span>
<span class="n">DR</span><span class="o">=</span><span class="n">R</span><span class="p">[</span><span class="n">im1</span><span class="p">]</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="n">im0</span><span class="p">]</span>

<span class="c1"># estimation method 2</span>
<span class="k">def</span> <span class="nf">localization</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">im1</span><span class="p">,</span><span class="n">im0</span><span class="p">,</span><span class="n">DR</span><span class="p">):</span>
        
    <span class="n">b0</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">im1</span><span class="p">,:]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">im0</span><span class="p">,:]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">DR</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">b1</span><span class="o">=</span><span class="n">DR</span>

    <span class="n">D</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="n">im1</span><span class="p">,:]</span><span class="o">-</span><span class="n">h</span><span class="p">[</span><span class="n">im0</span><span class="p">,:]</span>
    <span class="n">A</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">D</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">AI</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

    <span class="n">u0</span><span class="o">=</span><span class="n">AI</span><span class="nd">@b0</span>
    <span class="n">r0</span><span class="o">=</span><span class="n">u0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">S</span><span class="o">=</span><span class="n">u0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">S</span><span class="p">,</span><span class="n">r0</span>

<span class="n">S</span><span class="p">,</span><span class="n">r0</span><span class="o">=</span><span class="n">localization</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">im1</span><span class="p">,</span><span class="n">im0</span><span class="p">,</span><span class="n">DR</span><span class="p">)</span>

<span class="c1"># check with simulation</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;w:&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="s1">&#39;S:&#39;</span><span class="p">,</span><span class="n">S</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R[0]:&#39;</span><span class="p">,</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;r0:&#39;</span><span class="p">,</span><span class="n">r0</span><span class="p">)</span>

<span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;kx&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>w: [ 4 10  2] S: [ 4. 10.  2.]
R[0]: 10.954451150103322 r0: 10.954451150103374
</pre></div>
</div>
<img alt="_images/8860a63d415738c72f4c3a0dc8db49840fdb4a95263807253d2d7c88f8c9d32b.png" src="_images/8860a63d415738c72f4c3a0dc8db49840fdb4a95263807253d2d7c88f8c9d32b.png" />
</div>
</div>
</section>
</section>
<section id="four-hydrophone-localization">
<h2>Four-hydrophone localization<a class="headerlink" href="#four-hydrophone-localization" title="Link to this heading">#</a></h2>
<p>Four hydrophones allow 3 hydrophone pairs that in matrix notation are written as</p>
<div class="amsmath math notranslate nohighlight" id="equation-4db4de7e-8503-4115-8a39-a474ca970f96">
<span class="eqno">()<a class="headerlink" href="#equation-4db4de7e-8503-4115-8a39-a474ca970f96" title="Permalink to this equation">#</a></span>\[\begin{equation}
\left(\begin{matrix}(x_1-x_0)&amp;(y_1-y_0)&amp;(z_1-z_0)\\(x_2-x_0)&amp;(y_2-y_0)&amp;(z_2-z_0)\\(x_3-x_0)&amp;(y_3-y_0)&amp;(z_3-z_0)\end{matrix}\right)s
=\frac{1}{2}
\left(\begin{matrix}|h_1|^2-|h_0|^2-(\delta R_{10})^2\\|h_2|^2-|h_0|^2-(\delta R_{20})^2\\|h_3|^2-|h_0|^2-(\delta R_{30})^2\end{matrix}\right)
-\left(\begin{matrix}\delta R_{10}\\\delta R_{20}\\\delta R_{30}\end{matrix}\right)R_0
\end{equation}\]</div>
<p>or equivalently</p>
<div class="amsmath math notranslate nohighlight" id="equation-23caf637-b073-42fd-8802-e18bbab350b7">
<span class="eqno">()<a class="headerlink" href="#equation-23caf637-b073-42fd-8802-e18bbab350b7" title="Permalink to this equation">#</a></span>\[\begin{equation}
s=u_0-u_1R_0
\end{equation}\]</div>
<p>and the solution is obtained via the quadratic equation in <span class="math notranslate nohighlight">\(R_0\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># four hydrophones</span>
<span class="n">h</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span>
<span class="n">D</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span><span class="o">-</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">DI</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>

<span class="c1">#simulasted whale location above hydrophone plane</span>
<span class="n">w</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># whale directions from hydrophone</span>
<span class="n">D</span><span class="o">=</span><span class="n">w</span><span class="o">-</span><span class="n">h</span>
<span class="c1"># slant ranges</span>
<span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">D</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># for selecting hydrophone pairs</span>
<span class="n">im1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">im0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#</span>
<span class="c1"># simulated path differences</span>
<span class="n">DR</span><span class="o">=</span><span class="n">R</span><span class="p">[</span><span class="n">im1</span><span class="p">]</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="n">im0</span><span class="p">]</span>

<span class="n">u0</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">az</span><span class="p">,</span><span class="n">el</span><span class="o">=</span><span class="n">direction</span><span class="p">(</span><span class="n">DI</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">im1</span><span class="p">,</span><span class="n">im0</span><span class="p">,</span><span class="n">DR</span><span class="p">)</span>

<span class="c1"># check with simulation</span>
<span class="n">z</span><span class="o">=</span><span class="n">w</span><span class="o">-</span><span class="n">u0</span><span class="o">.</span><span class="n">T</span>
<span class="n">z1</span><span class="o">=</span><span class="n">z</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">azo</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">elo</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z:&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;u1:&#39;</span><span class="p">,</span><span class="n">u1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;az:&#39;</span><span class="p">,</span><span class="n">az</span><span class="p">,</span> <span class="s1">&#39;el:&#39;</span><span class="p">,</span><span class="n">el</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;azo:&#39;</span><span class="p">,</span><span class="n">azo</span><span class="p">,</span><span class="s1">&#39;elo:&#39;</span><span class="p">,</span><span class="n">elo</span><span class="p">)</span>

<span class="c1"># range estimation</span>
<span class="n">S</span><span class="p">,</span><span class="n">r0</span><span class="o">=</span><span class="n">rangeEstimation</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;S:&#39;</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="s1">&#39;r0:&#39;</span><span class="p">,</span><span class="n">r0</span><span class="p">)</span>


<span class="c1"># to visualize direction</span>
<span class="n">rr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">vv</span><span class="o">=</span><span class="n">u0</span><span class="o">-</span><span class="n">u1</span><span class="o">*</span><span class="n">rr</span>

<span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">u0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">u0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">vv</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>z: [[-0.9614814  0.        -0.3919192]]
u1: [[8.77708416e-02 1.91364755e-17 3.57771647e-02]]
az: [-180.] el: [-22.17679975]
azo: 180.0 elo: -22.176799751820553
S: [ 4. 10.  2.] r0: 10.954451150103324
</pre></div>
</div>
<img alt="_images/2b2fa4744a900d7e37a4b299451a2f17aa0f4947f3fb4b04321c27f273e410c1.png" src="_images/2b2fa4744a900d7e37a4b299451a2f17aa0f4947f3fb4b04321c27f273e410c1.png" />
</div>
</div>
</section>
<section id="three-hydrophone-localization">
<h2>Three-hydrophone localization<a class="headerlink" href="#three-hydrophone-localization" title="Link to this heading">#</a></h2>
<p>With three hydrophones once can form two pairs of hydrophones and one gets a system of two equations</p>
<div class="amsmath math notranslate nohighlight" id="equation-604e6019-e911-4a35-a130-284ac4e94b17">
<span class="eqno">()<a class="headerlink" href="#equation-604e6019-e911-4a35-a130-284ac4e94b17" title="Permalink to this equation">#</a></span>\[\begin{equation}
\left(\begin{matrix}(x_1-x_0)&amp;(y_1-y_0)&amp;(z_1-z_0)\\(x_2-x_0)&amp;(y_2-y_0)&amp;(z_2-z_0)\end{matrix}\right)s
=\frac{1}{2}
\left(\begin{matrix}|h_1|^2-|h_0|^2-(\delta R_{10})^2\\|h_2|^2-|h_0|^2-(\delta R_{20})^2\end{matrix}\right)
-\left(\begin{matrix}\delta R_{10}\\\delta R_{20}\end{matrix}\right)R_0
\end{equation}\]</div>
<p>which cannot be solved using standard algebraic methods (matix inversion), but requires the use of what is called a pseudo inverse and additional contraints or data.</p>
<p>To estimate source location with three hydrophones requires the knowledge of one component of the source vector. This is typically the z-component <span class="math notranslate nohighlight">\(s_z\)</span>.</p>
<p>The source range <span class="math notranslate nohighlight">\(R_0\)</span> is then estimated ba adding the assumed z-component <span class="math notranslate nohighlight">\(s_z\)</span> as constant to the quadratic equation</p>
<div class="amsmath math notranslate nohighlight" id="equation-a0410216-a0d3-412f-bf7f-b470399b7b32">
<span class="eqno">()<a class="headerlink" href="#equation-a0410216-a0d3-412f-bf7f-b470399b7b32" title="Permalink to this equation">#</a></span>\[\begin{equation}
c=|u_0-h_0|^2+(s_z-z_0)^2=(u_{0x}-x_0)^2+(u_{0y}-y_0)^2+(s_z-z_0)^2
\end{equation}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># three hydrophones</span>
<span class="n">h</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">D</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span><span class="o">-</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">DI</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>

<span class="c1">#simulasted whale location above hydrophone plane</span>
<span class="n">w</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># whale directions from hydrophone</span>
<span class="n">D</span><span class="o">=</span><span class="n">w</span><span class="o">-</span><span class="n">h</span>
<span class="c1"># slant ranges</span>
<span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">D</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># for selecting hydrophone pairs</span>
<span class="n">im1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">im0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#</span>
<span class="c1"># simulated path differences</span>
<span class="n">DR</span><span class="o">=</span><span class="n">R</span><span class="p">[</span><span class="n">im1</span><span class="p">]</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="n">im0</span><span class="p">]</span>

<span class="n">u0</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">az</span><span class="p">,</span><span class="n">el</span><span class="o">=</span><span class="n">direction</span><span class="p">(</span><span class="n">DI</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">im1</span><span class="p">,</span><span class="n">im0</span><span class="p">,</span><span class="n">DR</span><span class="p">)</span>

<span class="c1"># check with simulation</span>
<span class="n">z</span><span class="o">=</span><span class="n">w</span><span class="o">-</span><span class="n">u0</span><span class="o">.</span><span class="n">T</span>
<span class="n">z1</span><span class="o">=</span><span class="n">z</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">azo</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z:&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;u1:&#39;</span><span class="p">,</span><span class="n">u1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;az:&#39;</span><span class="p">,</span><span class="n">az</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;azo:&#39;</span><span class="p">,</span><span class="n">azo</span><span class="p">)</span>


<span class="c1"># range estimation</span>
<span class="c1"># assume known z-component</span>
<span class="n">u1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
<span class="n">u0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">w</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="c1">#</span>
<span class="n">S</span><span class="p">,</span><span class="n">r0</span><span class="o">=</span><span class="n">rangeEstimation</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;S:&#39;</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="s1">&#39;r0:&#39;</span><span class="p">,</span><span class="n">r0</span><span class="p">)</span>

<span class="c1"># to visualize direction</span>
<span class="n">rr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">vv</span><span class="o">=</span><span class="n">u0</span><span class="o">-</span><span class="n">u1</span><span class="o">*</span><span class="n">rr</span>

<span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">u0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">u0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">vv</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;kx&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>z: [[-0.9614814  0.         2.       ]]
u1: [[0.08777084 0.         0.        ]]
az: [-180.]
azo: 180.0
S: [ 4. 10.  2.] r0: 10.95445115010332
</pre></div>
</div>
<img alt="_images/716484e4c4f83d9757594b74771482cdce7be9927be451abbdd6f09d29b15ae1.png" src="_images/716484e4c4f83d9757594b74771482cdce7be9927be451abbdd6f09d29b15ae1.png" />
</div>
</div>
</section>
<section id="two-hydrophone-localization">
<h2>Two-hydrophone localization<a class="headerlink" href="#two-hydrophone-localization" title="Link to this heading">#</a></h2>
<p>with two hydrophones, one can form a single pair and with <span class="math notranslate nohighlight">\((i,j)=(1,0)\)</span> the resulting single equation becomes</p>
<div class="amsmath math notranslate nohighlight" id="equation-7469669c-9ea8-488b-b3c5-67d23df6b472">
<span class="eqno">()<a class="headerlink" href="#equation-7469669c-9ea8-488b-b3c5-67d23df6b472" title="Permalink to this equation">#</a></span>\[\begin{equation}
(h_1-h_0)^Ts=\frac{|h_1|^2-|h_0|^2-(\delta R_{10})^2}{2}-(\delta R_{10})R_0
\end{equation}\]</div>
<p>which cannot be solved for the source location without knowing two of the three components of the source vector. While sometimes the vertical, or z component of the source vector may be guessed an assumed, this is nearly impossible for the still missing horizontal component of the source vector.</p>
<p>With only two hydrophones, localization is nearly impossible, but the direction of the soundsource may still be obtained, if the source is far away.</p>
</section>
<section id="direction-finding">
<h2>Direction finding<a class="headerlink" href="#direction-finding" title="Link to this heading">#</a></h2>
<p>Given</p>
<div class="amsmath math notranslate nohighlight" id="equation-3d5ee7ea-6564-44df-bf9a-e14bfa43da80">
<span class="eqno">()<a class="headerlink" href="#equation-3d5ee7ea-6564-44df-bf9a-e14bfa43da80" title="Permalink to this equation">#</a></span>\[\begin{equation}
(h_i-h_j)^Ts=\frac{|h_i|^2-|h_j|^2-(\delta R_{ij})^2}{2}-(\delta R_{ij})R_j
\end{equation}\]</div>
<p>and assuming that all phones are closely spaced compared to distance to source</p>
<p>and noting that</p>
<div class="amsmath math notranslate nohighlight" id="equation-0cf87da8-5330-4a61-b081-6b8e66de2f99">
<span class="eqno">()<a class="headerlink" href="#equation-0cf87da8-5330-4a61-b081-6b8e66de2f99" title="Permalink to this equation">#</a></span>\[\begin{equation}
(h_i-h_j)^Ts=|h_i-h_j||s|\cos{(\beta)}
\end{equation}\]</div>
<p>or equivalently with <span class="math notranslate nohighlight">\(s=|s|\hat{s}\)</span> and dividing by <span class="math notranslate nohighlight">\(|s|\)</span></p>
<div class="amsmath math notranslate nohighlight" id="equation-516d40b5-114f-47a0-887d-8f5e0dfacb93">
<span class="eqno">()<a class="headerlink" href="#equation-516d40b5-114f-47a0-887d-8f5e0dfacb93" title="Permalink to this equation">#</a></span>\[\begin{equation}
(h_i-h_j)^T\hat{s}=|h_i-h_j|\cos{(\beta)}
\end{equation}\]</div>
<p>then</p>
<div class="amsmath math notranslate nohighlight" id="equation-dd55dd99-1c5a-4004-9220-1275dac0b9d5">
<span class="eqno">()<a class="headerlink" href="#equation-dd55dd99-1c5a-4004-9220-1275dac0b9d5" title="Permalink to this equation">#</a></span>\[\begin{equation}
|h_i-h_j|\cos{(\beta)}=\frac{|h_i|^2-|h_j|^2-(\delta R_{ij})^2}{2|s|}-(\delta R_{ij})\frac{R_j}{|s|}
\end{equation}\]</div>
<p>Let</p>
<div class="amsmath math notranslate nohighlight" id="equation-89c2aa66-0d92-4e2a-9fe0-d6090dadde91">
<span class="eqno">()<a class="headerlink" href="#equation-89c2aa66-0d92-4e2a-9fe0-d6090dadde91" title="Permalink to this equation">#</a></span>\[\begin{equation}
R_j=|s-h_j|
\end{equation}\]</div>
<p>then</p>
<div class="amsmath math notranslate nohighlight" id="equation-ee693d05-16a9-48ba-aead-517839ff12d6">
<span class="eqno">()<a class="headerlink" href="#equation-ee693d05-16a9-48ba-aead-517839ff12d6" title="Permalink to this equation">#</a></span>\[\begin{equation}
|h_i-h_j|\cos{(\beta)}=\frac{|h_i|^2-|h_j|^2-(\delta R_{ij})^2}{2|s|}-(\delta R_{ij})\frac{|s-h_j|}{|s|}
\end{equation}\]</div>
<p>which for <span class="math notranslate nohighlight">\(|s| \to \infty\)</span> becomes an equation that may be used to estimate the direction <span class="math notranslate nohighlight">\(\beta\)</span> to a distant sound source.</p>
<div class="amsmath math notranslate nohighlight" id="equation-f0b45f0e-b755-4736-84d3-6befb2b537e2">
<span class="eqno">()<a class="headerlink" href="#equation-f0b45f0e-b755-4736-84d3-6befb2b537e2" title="Permalink to this equation">#</a></span>\[\begin{equation}
(h_i-h_j)^T\hat{s}=-(\delta R_{ij})
\end{equation}\]</div>
<p>This equation is the basis for all direction finding algorithms that are based on time-delay of arrival (TDOA)</p>
</section>
<section id="multi-phone-direction-finding">
<h2>Multi-phone direction finding<a class="headerlink" href="#multi-phone-direction-finding" title="Link to this heading">#</a></h2>
<p>Let</p>
<div class="amsmath math notranslate nohighlight" id="equation-6bf09dfe-3bb2-4db1-95a8-6a2ab0f4aaf0">
<span class="eqno">()<a class="headerlink" href="#equation-6bf09dfe-3bb2-4db1-95a8-6a2ab0f4aaf0" title="Permalink to this equation">#</a></span>\[\begin{equation}
(h_i-h_j)^T\hat{s}=-(\delta R_{ij})
\end{equation}\]</div>
<p>and assume an array of <span class="math notranslate nohighlight">\(n+1\)</span> phones then one can form  <span class="math notranslate nohighlight">\(npp=(n+1)n/2\)</span> different pairs of phones resulting to a system of <span class="math notranslate nohighlight">\(npp\)</span> equations</p>
<div class="amsmath math notranslate nohighlight" id="equation-69792b18-dae1-4c68-933b-1fddc0448035">
<span class="eqno">()<a class="headerlink" href="#equation-69792b18-dae1-4c68-933b-1fddc0448035" title="Permalink to this equation">#</a></span>\[\begin{equation}
\left(\begin{matrix} (x_1-x_0)&amp;(y_1-y_0)&amp;(z_1-z_0)\\
                        (x_1-x_0)&amp;(y_1-y_0)&amp;(z_1-z_0)\\
                        \vdots&amp;\vdots&amp;\vdots\\ 
                        (x_n-x_{n-1})&amp;(y_n-y_{n-1})&amp;(z_n-z_{n-1})
                        \end{matrix}\right)\hat{s}=-
\left(\begin{matrix} \delta R_{10}\\\delta R_{20}\\\vdots\\\delta R_{n(n-1)}
                        \end{matrix}\right)                        
\end{equation}\]</div>
<p>With</p>
<div class="amsmath math notranslate nohighlight" id="equation-26986953-14bd-4fa5-86f2-547b6bb4c4a1">
<span class="eqno">()<a class="headerlink" href="#equation-26986953-14bd-4fa5-86f2-547b6bb4c4a1" title="Permalink to this equation">#</a></span>\[\begin{equation}
A=
\left(\begin{matrix} (x_1-x_0)&amp;(y_1-y_0)&amp;(z_1-z_0)\\
                        (x_1-x_0)&amp;(y_1-y_0)&amp;(z_1-z_0)\\
                        \vdots&amp;\vdots&amp;\vdots\\ 
                        (x_n-x_{n-1})&amp;(y_n-y_{n-1})&amp;(z_n-z_{n-1})
                        \end{matrix}\right)                        
\end{equation}\]</div>
<div class="amsmath math notranslate nohighlight" id="equation-af0e412f-5d91-48ad-a63e-756b8636b8af">
<span class="eqno">()<a class="headerlink" href="#equation-af0e412f-5d91-48ad-a63e-756b8636b8af" title="Permalink to this equation">#</a></span>\[\begin{equation}
b_1=
\left(\begin{matrix} \delta R_{10}\\\delta R_{20}\\\vdots\\\delta R_{n(n-1)}
                        \end{matrix}\right)                        
\end{equation}\]</div>
<p>the solution for the source direction vector <span class="math notranslate nohighlight">\(\hat{s}\)</span> becomes</p>
<div class="amsmath math notranslate nohighlight" id="equation-486c63e9-9409-4fb0-8520-a16117144e70">
<span class="eqno">()<a class="headerlink" href="#equation-486c63e9-9409-4fb0-8520-a16117144e70" title="Permalink to this equation">#</a></span>\[\begin{equation}
\hat{s}=-A^+b_1
\end{equation}\]</div>
<p>It should be noted that the path difference <span class="math notranslate nohighlight">\(\delta R_{ij}=R_i-R_j\)</span>, where <span class="math notranslate nohighlight">\(R_j\)</span> is the path to the reference phone, is negative if the sound arrives first to phone at <span class="math notranslate nohighlight">\(h_i\)</span> and then to the one at <span class="math notranslate nohighlight">\(h_j\)</span>, as it would for <span class="math notranslate nohighlight">\(\cos{\beta}&gt;0\)</span>.</p>
</section>
<section id="four-phone-direction-finding">
<h2>Four-phone direction finding<a class="headerlink" href="#four-phone-direction-finding" title="Link to this heading">#</a></h2>
<p>The four phones are assumed to bo not in the same plane, i.e. they are distributed in 3D.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1">#</span>
<span class="c1">#geometry</span>
<span class="k">if</span> <span class="mi">1</span><span class="p">:</span>   <span class="c1"># pyramide</span>
    <span class="n">h</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">60</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">60</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">120</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">120</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">60</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="mi">30</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">60</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="mi">30</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)]])</span>
<span class="k">else</span><span class="p">:</span>   <span class="c1"># on cube</span>
    <span class="n">h</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="c1">#estmate hydrophone connection vectors</span>
<span class="n">im1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">im0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">D</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="n">im1</span><span class="p">,:]</span><span class="o">-</span><span class="n">h</span><span class="p">[</span><span class="n">im0</span><span class="p">,:]</span>
<span class="n">L</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">D</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="c1">#</span>
<span class="c1">#print(h)</span>
<span class="c1">#print(L)</span>

<span class="c1"># invert geometry needed for direction finding</span>
<span class="n">DI</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># simulated direction</span>
<span class="n">az</span><span class="o">=</span><span class="mi">45</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
<span class="n">el</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>

<span class="n">S</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">az</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">el</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">az</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">el</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">el</span><span class="p">)])</span>

<span class="c1"># simulate path differences</span>
<span class="n">DR</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">S</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">DR</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-0.8365163  -0.22414387 -0.76180168  0.61237244  0.07471462 -0.53765781]
</pre></div>
</div>
<img alt="_images/bf932490ec436ffd429908f4ddfb694785cbd82c5e80b8f1d0a53941d1aca753.png" src="_images/bf932490ec436ffd429908f4ddfb694785cbd82c5e80b8f1d0a53941d1aca753.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">directionFinding</span><span class="p">(</span><span class="n">DI</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>
    <span class="c1">#direction finding</span>
    <span class="n">SX</span><span class="o">=-</span><span class="n">DI</span><span class="nd">@M</span>

    <span class="c1"># estimate and print angles</span>
    <span class="n">az</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">SX</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">SX</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">el</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">SX</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SX</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">SX</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">return</span> <span class="n">az</span><span class="p">,</span><span class="n">el</span>
<span class="n">az</span><span class="p">,</span><span class="n">el</span><span class="o">=</span><span class="n">directionFinding</span><span class="p">(</span><span class="n">DI</span><span class="p">,</span><span class="n">DR</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">az</span><span class="p">,</span><span class="n">el</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>44.99999999999999 29.999999999999993
</pre></div>
</div>
</div>
</div>
</section>
<section id="three-phone-direction-finding">
<h2>Three-phone direction finding<a class="headerlink" href="#three-phone-direction-finding" title="Link to this heading">#</a></h2>
<p>all three phones in same plane, so set z-component to 0</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1">#</span>
<span class="c1">#geometry</span>
<span class="n">h</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">60</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">60</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span><span class="mi">0</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">120</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">120</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span><span class="mi">0</span><span class="p">]])</span>

<span class="c1">#estmate hydrophone connection vectors</span>
<span class="n">im1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">im0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">D</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="n">im1</span><span class="p">,:]</span><span class="o">-</span><span class="n">h</span><span class="p">[</span><span class="n">im0</span><span class="p">,:]</span>

<span class="c1"># invert geometry needed for direction finding</span>
<span class="n">DI</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">DI</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ 3.33333333e-01 -3.33333333e-01 -6.66666667e-01]
 [ 5.77350269e-01  5.77350269e-01  1.66533454e-16]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># simulated direction</span>
<span class="n">az</span><span class="o">=</span><span class="mi">45</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
<span class="n">el</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>

<span class="n">S</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">az</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">el</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">az</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">el</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">el</span><span class="p">)])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># simulate path differences (project hydrophone differences onto source direction)</span>
<span class="n">DR</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">S</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3e92e086dbb2e1290b9a6c6b555b6e5c23c87c2ec722254962a27448ba7f87d8.png" src="_images/3e92e086dbb2e1290b9a6c6b555b6e5c23c87c2ec722254962a27448ba7f87d8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">directionFinding</span><span class="p">(</span><span class="n">DI</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>
    <span class="c1">#direction finding</span>
    <span class="n">SX</span><span class="o">=-</span><span class="n">DI</span><span class="nd">@M</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="n">DI</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="c1">#extend direction vector and estimate z-component</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SX</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="n">SX</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">SX</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">SX</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># estimate and print angles</span>
    <span class="n">az</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">SX</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">SX</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">el</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">SX</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SX</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">SX</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">return</span> <span class="n">az</span><span class="p">,</span><span class="n">el</span>
<span class="n">az</span><span class="p">,</span><span class="n">el</span><span class="o">=</span><span class="n">directionFinding</span><span class="p">(</span><span class="n">DI</span><span class="p">,</span><span class="n">DR</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">az</span><span class="p">,</span><span class="n">el</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>44.99999999999999 30.00000000000003
</pre></div>
</div>
</div>
</div>
</section>
<section id="beamforming">
<h2>Beamforming<a class="headerlink" href="#beamforming" title="Link to this heading">#</a></h2>
<p>Beamforming is based on the fact that signal (here sound) arrives at different times at distributed (array of) sensors (here hydrophones).</p>
<p>While the direction of single sound source may be estimated by measuring the relative delays within the hydrophone array and relating these measurements to the array geometry, beamforming analyses the arriving sound field for all possible direections (beams).</p>
<section id="basic-formulation-of-single-source-direction-finding">
<h3>Basic formulation of single source direction finding<a class="headerlink" href="#basic-formulation-of-single-source-direction-finding" title="Link to this heading">#</a></h3>
<p>Let the sound direction  <span class="math notranslate nohighlight">\(\hat S\)</span> be given by</p>
<div class="amsmath math notranslate nohighlight" id="equation-08514367-cb5b-4067-b698-59dae96f51a2">
<span class="eqno">()<a class="headerlink" href="#equation-08514367-cb5b-4067-b698-59dae96f51a2" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \hat S = 
    \left(
        \begin{array}{c}
            S_x\\
            S_y\\
            S_z
        \end{array}
    \right)  
\end{equation}\]</div>
<p>and the hydrophone location matrix <span class="math notranslate nohighlight">\( H \)</span> be given by</p>
<div class="amsmath math notranslate nohighlight" id="equation-548bab9d-fce7-4559-9fca-1733acaf018e">
<span class="eqno">()<a class="headerlink" href="#equation-548bab9d-fce7-4559-9fca-1733acaf018e" title="Permalink to this equation">#</a></span>\[\begin{equation}
     H = 
    \left(
        \begin{array}{c c c c}
            h_{0x} &amp; h_{1x} &amp; ... &amp; h_{nx}\\
            h_{0y} &amp; h_{1y} &amp; ... &amp; h_{ny}\\
            h_{0z} &amp; h_{1z} &amp; ... &amp; h_{nz}\\
        \end{array}
    \right)  
\end{equation}\]</div>
<p>where the elements <span class="math notranslate nohighlight">\((d_{ix},d_{iy},d_{iz}) \)</span> are the <span class="math notranslate nohighlight">\(x,y,z\)</span> components of the 3-D vector that locates the hydrophones.</p>
<p>Let <span class="math notranslate nohighlight">\(D_0\)</span> be the hydrophone seperation matrix</p>
<div class="amsmath math notranslate nohighlight" id="equation-d641ffdd-5750-4787-9473-12043d259b4d">
<span class="eqno">()<a class="headerlink" href="#equation-d641ffdd-5750-4787-9473-12043d259b4d" title="Permalink to this equation">#</a></span>\[\begin{equation}
     D_0 = H-{h_0}=
    \left(
        \begin{array}{c c c c}
            d_{1x} &amp; d_{2x} &amp; ... &amp; d_{nx}\\
            d_{1y} &amp; d_{2y} &amp; ... &amp; d_{ny}\\
            d_{1z} &amp; d_{2z} &amp; ... &amp; d_{nz}\\
        \end{array}
    \right)  
\end{equation}\]</div>
<p>then the vector of measurements <span class="math notranslate nohighlight">\( m\)</span> defined by</p>
<div class="amsmath math notranslate nohighlight" id="equation-4e61e336-2c4d-46fd-ad31-00754b27ba27">
<span class="eqno">()<a class="headerlink" href="#equation-4e61e336-2c4d-46fd-ad31-00754b27ba27" title="Permalink to this equation">#</a></span>\[\begin{equation}
     m = 
    \left(
        \begin{array}{c}
            m_1\\
            m_2\\
            \vdots\\
            m_n
        \end{array}
    \right)  
\end{equation}\]</div>
<p>is estimated by the projection of the sound source direction onto the different hydrophone pairs.</p>
<div class="amsmath math notranslate nohighlight" id="equation-8e56d471-c077-4881-b723-88d8511063e3">
<span class="eqno">()<a class="headerlink" href="#equation-8e56d471-c077-4881-b723-88d8511063e3" title="Permalink to this equation">#</a></span>\[\begin{equation}
     m =  D_0^T  {\hat S}
\end{equation}\]</div>
<p>The sound direction is then estimated from the measurement vector by</p>
<div class="amsmath math notranslate nohighlight" id="equation-1813d64e-157c-4505-9c0a-feda1bf928d3">
<span class="eqno">()<a class="headerlink" href="#equation-1813d64e-157c-4505-9c0a-feda1bf928d3" title="Permalink to this equation">#</a></span>\[\begin{equation}
    {\hat S} = \left( D_0^T  D_0 \right)^{-1}  D_0  m
\end{equation}\]</div>
<section id="line-array">
<h4>Line array<a class="headerlink" href="#line-array" title="Link to this heading">#</a></h4>
<p>In case where the array geometry is a line array then typically one assumes that <span class="math notranslate nohighlight">\((h_{iy},h_{iz})=(0,0)\)</span> and we get</p>
<div class="amsmath math notranslate nohighlight" id="equation-febed7cd-b679-4fee-85d5-c31e26cbc365">
<span class="eqno">()<a class="headerlink" href="#equation-febed7cd-b679-4fee-85d5-c31e26cbc365" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \hat S_x = \frac{\sum_i(d_{ix}m_i)} {\sum_i(d_{ix}^2)}
\end{equation}\]</div>
</section>
</section>
<section id="basic-formulation-of-beamforming">
<h3>Basic formulation of beamforming<a class="headerlink" href="#basic-formulation-of-beamforming" title="Link to this heading">#</a></h3>
<p>Let the sound pressure measured an a single hydrophone be composed of a signal <span class="math notranslate nohighlight">\(s\)</span> and some noise <span class="math notranslate nohighlight">\(n\)</span></p>
<div class="amsmath math notranslate nohighlight" id="equation-868303ef-b537-4bb7-bbc3-8abbbe784749">
<span class="eqno">()<a class="headerlink" href="#equation-868303ef-b537-4bb7-bbc3-8abbbe784749" title="Permalink to this equation">#</a></span>\[\begin{equation}
x(t)=s(t)+n(t)
\end{equation}\]</div>
<p>then in an array of hydrophones the measurements become</p>
<div class="amsmath math notranslate nohighlight" id="equation-40f55c27-8d10-4611-9580-38c64ae1644a">
<span class="eqno">()<a class="headerlink" href="#equation-40f55c27-8d10-4611-9580-38c64ae1644a" title="Permalink to this equation">#</a></span>\[\begin{equation}
x_i(t)=s(t-\tau_i(\alpha,\beta))+n(t)
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(\tau_i(\alpha,\beta)\)</span> is the delay of the signal at hydrophone <span class="math notranslate nohighlight">\(i\)</span> with respect to some reference hydrophone and <span class="math notranslate nohighlight">\(\alpha,\beta\)</span> are the angles of arrival</p>
<p>For a line array with equally spaced hydrophones the delay has a simple form</p>
<div class="amsmath math notranslate nohighlight" id="equation-150214b0-4bf4-4c52-b79f-d77ed9a5c394">
<span class="eqno">()<a class="headerlink" href="#equation-150214b0-4bf4-4c52-b79f-d77ed9a5c394" title="Permalink to this equation">#</a></span>\[\begin{equation}
\tau_i(t)=i\frac{d}{c}\cos{\gamma}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(d\)</span> id the hydrophone spacing, <span class="math notranslate nohighlight">\(c\)</span> is the sound speed at the hydrophone, and <span class="math notranslate nohighlight">\(\gamma\)</span> is the relative angle of arrival, that for a line array is composed of the azimuth <span class="math notranslate nohighlight">\(\alpha\)</span> and elevation angle <span class="math notranslate nohighlight">\(\beta\)</span>.</p>
<div class="amsmath math notranslate nohighlight" id="equation-6dc4d1c4-a82d-4b22-8691-45edcbf36f8e">
<span class="eqno">()<a class="headerlink" href="#equation-6dc4d1c4-a82d-4b22-8691-45edcbf36f8e" title="Permalink to this equation">#</a></span>\[\begin{equation}
\cos{\gamma}=\cos{\alpha}\cos{\beta}
\end{equation}\]</div>
<p>The beamforming algorithm simply speaking tries to undo the signal delays <span class="math notranslate nohighlight">\(\tau_i(\alpha,\beta)\)</span> by compensating with negative delays</p>
<div class="amsmath math notranslate nohighlight" id="equation-7f771a3f-cc41-44b9-b6a8-bdcea7ba5f49">
<span class="eqno">()<a class="headerlink" href="#equation-7f771a3f-cc41-44b9-b6a8-bdcea7ba5f49" title="Permalink to this equation">#</a></span>\[\begin{equation}
x(t)=\frac{1}{N}\sum_i (x_t(+\delta_i(\gamma)))
\end{equation}\]</div>
<p>In cases, where <span class="math notranslate nohighlight">\(\delta_i(\gamma)=\tau_i(\alpha,\beta)\)</span> we get</p>
<div class="amsmath math notranslate nohighlight" id="equation-58e594cc-523b-4ae9-937a-1e02bd2cc809">
<span class="eqno">()<a class="headerlink" href="#equation-58e594cc-523b-4ae9-937a-1e02bd2cc809" title="Permalink to this equation">#</a></span>\[\begin{equation}
x(t)=s(t)+\frac{1}{N}\sum_i(n(t+\delta_i(\gamma)))
\end{equation}\]</div>
<p>indicating that the signal <span class="math notranslate nohighlight">\(s(t)\)</span> is completely reconstructed and that noise, that is assumed to be uncorrelated is attenuated.</p>
<p>In all other cases also the signal is attenuated die to delay mismatch.</p>
</section>
<section id="simulation">
<h3>Simulation<a class="headerlink" href="#simulation" title="Link to this heading">#</a></h3>
<p>In the following we simulate the beamforing with a line array of Zc clicks</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Simulation of Zc clicks</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">zcSig</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">fm</span><span class="p">,</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">cc</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">aa</span><span class="o">*</span><span class="n">tt</span><span class="p">)</span><span class="o">**</span><span class="n">bb</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">aa</span><span class="o">*</span><span class="n">tt</span><span class="p">)</span><span class="o">**</span><span class="n">cc</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">f0</span><span class="o">+</span><span class="n">fm</span><span class="o">*</span><span class="n">tt</span><span class="p">)</span><span class="o">*</span><span class="n">tt</span><span class="p">)</span>

<span class="n">fs</span><span class="o">=</span><span class="mi">192</span> <span class="c1">#kHz</span>
<span class="n">ts</span><span class="o">=</span><span class="mi">1</span> <span class="c1">#ms</span>
<span class="n">tt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ts</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>

<span class="n">f0</span><span class="o">=</span><span class="mi">30</span>
<span class="n">fm</span><span class="o">=</span><span class="mi">60</span>
<span class="n">aa</span><span class="o">=</span><span class="mi">13</span>
<span class="n">bb</span><span class="o">=</span><span class="mf">1.5</span>
<span class="n">cc</span><span class="o">=</span><span class="mf">1.5</span>
<span class="n">ss</span><span class="o">=</span><span class="n">zcSig</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">fm</span><span class="p">,</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">cc</span><span class="p">)</span>
<span class="n">ss</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="n">ss</span><span class="p">)</span>
<span class="n">tt</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">)))</span><span class="o">/</span><span class="n">fs</span>
<span class="c1">#tt=np.arange(-20/fs,ts,1/fs)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ss</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ss</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a44bebb9ae1b730f714658d28cbc3a6c57349771169faaf174995160eaf058ca.png" src="_images/a44bebb9ae1b730f714658d28cbc3a6c57349771169faaf174995160eaf058ca.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Line array</span>
<span class="n">c</span><span class="o">=</span><span class="mi">1500</span>      <span class="c1"># m/s sound speed</span>
<span class="n">d</span><span class="o">=</span><span class="mf">0.0125</span>    <span class="c1"># hydrophone spacing (0.75/60)</span>
<span class="n">N</span><span class="o">=</span><span class="mi">10</span>        <span class="c1"># number of hydrophones</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;d:&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
<span class="n">h</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">d</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d: 0.0125
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Overlap-add FIR filter, (c) Joachim Thiemann 2016</span>
<span class="c1"># https://github.com/jthiem/overlapadd/blob/master/olafilt.py</span>
<span class="c1">#</span>
<span class="k">def</span> <span class="nf">fftfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">zi</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter a one-dimensional array with an FIR filter</span>

<span class="sd">    Filter a data sequence, `x`, using a FIR filter given in `b`.</span>
<span class="sd">    Filtering uses the overlap-add method converting both `x` and `b`</span>
<span class="sd">    into frequency domain first.  The FFT size is determined as the</span>
<span class="sd">    next higher power of 2 of twice the length of `b`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    b : one-dimensional numpy array</span>
<span class="sd">        The impulse response of the filter</span>
<span class="sd">    x : one-dimensional numpy array</span>
<span class="sd">        Signal to be filtered</span>
<span class="sd">    zi : one-dimensional numpy array, optional</span>
<span class="sd">        Initial condition of the filter, but in reality just the</span>
<span class="sd">        runout of the previous computation.  If `zi` is None or not</span>
<span class="sd">        given, then zero initial state is assumed.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    y : array</span>
<span class="sd">        The output of the digital filter.</span>
<span class="sd">    zf : array, optional</span>
<span class="sd">        If `zi` is None, this is not returned, otherwise, `zf` holds the</span>
<span class="sd">        final filter delay values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">L_I</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Find power of 2 larger that 2*L_I (from abarnert on Stackoverflow)</span>
    <span class="n">L_F</span> <span class="o">=</span> <span class="mi">2</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">L_I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
    <span class="n">L_S</span> <span class="o">=</span> <span class="n">L_F</span> <span class="o">-</span> <span class="n">L_I</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">L_sig</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">offsets</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L_sig</span><span class="p">,</span> <span class="n">L_S</span><span class="p">)</span>

    <span class="c1"># handle complex or real input</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">fft_func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span>
        <span class="n">ifft_func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">L_sig</span><span class="o">+</span><span class="n">L_F</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fft_func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span>
        <span class="n">ifft_func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">irfft</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">L_sig</span><span class="o">+</span><span class="n">L_F</span><span class="p">)</span>

    <span class="n">FDir</span> <span class="o">=</span> <span class="n">fft_func</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">L_F</span><span class="p">)</span>

    <span class="c1"># overlap and add</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">offsets</span><span class="p">:</span>
        <span class="n">res</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="n">L_F</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ifft_func</span><span class="p">(</span><span class="n">fft_func</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="n">L_S</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="n">L_F</span><span class="p">)</span><span class="o">*</span><span class="n">FDir</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">zi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">res</span><span class="p">[:</span><span class="n">zi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[:</span><span class="n">zi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">zi</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[:</span><span class="n">L_sig</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="n">L_sig</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[:</span><span class="n">L_sig</span><span class="p">]</span>
    
</pre></div>
</div>
</div>
</div>
</section>
<section id="simulate-measurements">
<h3>Simulate measurements<a class="headerlink" href="#simulate-measurements" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>estimate the arrival times (up to a constant) for all hydrophones</p></li>
<li><p>delay time series using a fractional sinc function</p></li>
</ul>
<p>A sinc function is used as it is an all-pass filter with well defined delay proprty. Other interpolating low-pass filter may be used (e.g. Kaiser filters). The filters should be of FIR type to have well defined delay properties.</p>
<p>Here, to simplify the algorithm, no integer resampling is done, requiring somewhat more coefficients to minimize edge effects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># measurements</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>

<span class="n">fs</span><span class="o">=</span><span class="mi">192000</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c1"># noise</span>
    <span class="n">noise_power</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span> 
    <span class="n">ndat</span><span class="o">=</span><span class="n">fs</span><span class="o">//</span><span class="mi">100</span>
    <span class="n">M</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">noise_power</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">ndat</span><span class="p">))</span>

    <span class="c1"># estimate power spectral density (PSD)</span>
    <span class="n">win</span><span class="o">=</span><span class="n">signal</span><span class="o">.</span><span class="n">get_window</span><span class="p">(</span><span class="s2">&quot;hann&quot;</span><span class="p">,</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">Pxx_dens</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">win</span><span class="p">),</span> <span class="n">noverlap</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="s2">&quot;density&quot;</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">win</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">Pxx_dens</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency [kHz]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PSD [V**2/Hz]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span><span class="mf">1e-1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># signal</span>
<span class="n">iao</span><span class="o">=</span><span class="mi">60</span>  <span class="c1"># simulated angle</span>

<span class="n">xo</span><span class="o">=</span><span class="n">ss</span><span class="o">.</span><span class="n">real</span>
<span class="c1"># simulated delays relative to hydrophone 0</span>
<span class="n">tau</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="o">/</span><span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iao</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>

<span class="n">yy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xo</span><span class="p">),</span><span class="n">N</span><span class="p">))</span>

<span class="n">kk</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">uu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">kk</span><span class="o">-</span><span class="n">tau</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">yy</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">fftfilt</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span><span class="n">xo</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">yy</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/57bb13c9df1f862dee482442fe5af0979ae65ea3b89a01d07df66d30389fee24.png" src="_images/57bb13c9df1f862dee482442fe5af0979ae65ea3b89a01d07df66d30389fee24.png" />
</div>
</div>
</section>
<section id="check-steering">
<h3>check steering<a class="headerlink" href="#check-steering" title="Link to this heading">#</a></h3>
<p>To check method compensate simulated delay so that all hydrophone receive in parallel</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check steering (replace sinc(kk-tau[ii]*fs) by sinc(kk+tau[ii]*fs))</span>
<span class="n">vv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">),</span><span class="n">N</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">uu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="n">tau</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">vv</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">fftfilt</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span><span class="n">yy</span><span class="p">[:,</span><span class="n">ii</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">vv</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">vv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/49c618f6158cf9ef63922eeefeb7005486f0de95b4a33850417ad558f725faa8.png" src="_images/49c618f6158cf9ef63922eeefeb7005486f0de95b4a33850417ad558f725faa8.png" />
</div>
</div>
</section>
<section id="spatial-filtering-beamformer">
<h3>Spatial filtering (beamformer)<a class="headerlink" href="#spatial-filtering-beamformer" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Create first the filter coefficient matrix</p></li>
<li><p>filter all hydrophone using the adequate coefficients.</p></li>
<li><p>for each time step average all hydrophones</p></li>
</ul>
<p>inspection of the coefficients indicate that for the 0 and 180 deg cases edge effects may occur at the end of the array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># beamformer</span>

<span class="k">def</span> <span class="nf">delayMatrix</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span><span class="n">maxDel</span><span class="p">):</span>
    <span class="c1"># generate delay coefficient matrix</span>
    <span class="n">nc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">maxDel</span><span class="p">)</span><span class="o">+</span><span class="mi">10</span>  <span class="c1"># assume nimimum sinc coefficients: -10:10</span>
    <span class="n">kk</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">nc</span><span class="p">,</span><span class="n">nc</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ww</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">kk</span><span class="p">),</span><span class="n">dd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndir</span><span class="p">):</span>              <span class="c1"># over all beams</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>             <span class="c1"># over all hydrophones</span>
            <span class="n">arg</span><span class="o">=</span><span class="n">kk</span><span class="o">+</span><span class="n">dd</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">cc</span><span class="p">]</span>
            <span class="n">ww</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="n">cc</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ww</span>


<span class="n">ndir</span><span class="o">=</span><span class="mi">180</span>
<span class="n">dd</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ndir</span><span class="p">)</span><span class="o">/</span><span class="n">ndir</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">fs</span>
<span class="n">maxDel</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">c</span><span class="o">*</span><span class="n">fs</span>
<span class="n">ww</span><span class="o">=</span><span class="n">delayMatrix</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span><span class="n">maxDel</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;coefficient for last hydrophone for all beams&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ww</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="n">ndir</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;coefficients&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;beam direction [deg]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fb9e5ec75c02864342d662698b96808ed6707eed9cc72df6cb01d7fb4429c1f9.png" src="_images/fb9e5ec75c02864342d662698b96808ed6707eed9cc72df6cb01d7fb4429c1f9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># filter data (beamformer)</span>
<span class="k">def</span> <span class="nf">beamform</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span><span class="n">yy</span><span class="p">):</span>
    <span class="n">vv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">zz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ww</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndir</span><span class="p">):</span>              <span class="c1"># over all beams</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>             <span class="c1"># over all hydrophones</span>
            <span class="n">vv</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">fftfilt</span><span class="p">(</span><span class="n">ww</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="n">cc</span><span class="p">],</span><span class="n">yy</span><span class="p">[:,</span><span class="n">ii</span><span class="p">])</span>
        <span class="n">zz</span><span class="p">[:,</span><span class="n">cc</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>     <span class="c1"># sum hydrophones for each beam</span>
    <span class="k">return</span> <span class="n">zz</span>
<span class="c1">#</span>
<span class="n">zz</span><span class="o">=</span><span class="n">beamform</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span><span class="n">yy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;beamformed time series&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">zz</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">zz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="n">ndir</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;samples&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;beam direction [deg]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;beamformed time series&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">zz</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;samples&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;beam direction [deg]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1">#</span>
<span class="c1"># compare with input signal</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">ss</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">zz</span><span class="p">[:,</span><span class="n">iao</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f7d33a899e797f1769f45f9df98cb2e2c17d9dc520c1f1d433cb9d792b79bf85.png" src="_images/f7d33a899e797f1769f45f9df98cb2e2c17d9dc520c1f1d433cb9d792b79bf85.png" />
<img alt="_images/5da0177d77d2d1ee88bd337ea263c26b1b29d9cf50d76a6a5a6fe747f89dfc95.png" src="_images/5da0177d77d2d1ee88bd337ea263c26b1b29d9cf50d76a6a5a6fe747f89dfc95.png" />
<img alt="_images/c7202a2e24b3a5c13a0d60e3a21f347cf57e777d9b0787d8ed2981191d67288c.png" src="_images/c7202a2e24b3a5c13a0d60e3a21f347cf57e777d9b0787d8ed2981191d67288c.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sound-source-distance">Sound source distance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#system-of-equations">System of equations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pseudo-inverse">Pseudo inverse</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#source-location-and-range-estimation">Source location and range estimation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#quadratic-equation">Quadratic equation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#localization-with-five-or-more-hydrophones">Localization with five or more hydrophones</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-1">method 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-2">method 2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#four-hydrophone-localization">Four-hydrophone localization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#three-hydrophone-localization">Three-hydrophone localization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-hydrophone-localization">Two-hydrophone localization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direction-finding">Direction finding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-phone-direction-finding">Multi-phone direction finding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#four-phone-direction-finding">Four-phone direction finding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#three-phone-direction-finding">Three-phone direction finding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beamforming">Beamforming</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-formulation-of-single-source-direction-finding">Basic formulation of single source direction finding</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#line-array">Line array</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-formulation-of-beamforming">Basic formulation of beamforming</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation">Simulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-measurements">Simulate measurements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-steering">check steering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-filtering-beamformer">Spatial filtering (beamformer)</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Walter MX Zimmer
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>