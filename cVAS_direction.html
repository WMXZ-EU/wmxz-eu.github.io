
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Direction finding with compact Volumetric Acoustic Sensor (cVAS) &#8212; bioacoustics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'cVAS_direction';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Click train detector" href="Click_train_detector.html" />
    <link rel="prev" title="bioacoustic tools" href="bioacoustic_tools.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">bioacoustics</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Bioacoustics by WMXZ
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">General Bioacoustics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="wave_equation.html">Wave equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Zc_click.html">Cuvier’s beaked whale click</a></li>
<li class="toctree-l1"><a class="reference internal" href="power_spectra.html">Spectral estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sound_intensity.html">Sound Intensity</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Processing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="transient_detection.html">Transient detections</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi-phone-localization.html">Multi-phone localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="beamforming.html">Beamforming</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi-channel-processing.html">Multi channel processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="ray_tracing.html">Ray tracing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">cVAS</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="bioacoustic_tools.html">bioacoustic tools</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Direction finding with compact Volumetric Acoustic Sensor (cVAS)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Work in Progress</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Click_train_detector.html">Click train detector</a></li>
<li class="toctree-l1"><a class="reference internal" href="Detections.html">Click detection</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Bar La Mare</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="BLM/blm_0.html">BML_0: BAR_LA_MARE</a></li>
<li class="toctree-l1"><a class="reference internal" href="BLM/blm_1.html">BLM_1: Basic signal spectral analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="BLM/blm_2.html">BLM_2:  Wave propagation</a></li>
<li class="toctree-l1"><a class="reference internal" href="BLM/blm_3.html">BLM_3: Underwater Sound Propagation</a></li>
<li class="toctree-l1"><a class="reference internal" href="BLM/blm_4.html">BLM_4: Spectrogram</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/wmxz-eu/wmxz-eu.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/wmxz-eu/wmxz-eu.github.io/issues/new?title=Issue%20on%20page%20%2FcVAS_direction.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/cVAS_direction.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Direction finding with compact Volumetric Acoustic Sensor (cVAS)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-libraries">Loading libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-of-cvas-sound-reception-from-a-deep-source-emitting-linear-frequency-modulated-lfm-signal">Simulation of cVAS sound reception from a deep source emitting linear frequency modulated (LFM) signal.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direction-finding-using-sound-intensity-vector">Direction finding using sound intensity vector</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direction-finding-using-phase-differences">Direction finding using phase differences</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direction-finding-using-hydrophone-spectrogram-based-cross-correlation">Direction finding using hydrophone spectrogram based cross correlation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direction-finding-using-time-delay-of-arrival-tdoa-of-matched-filtered-data">Direction finding using time-delay-of-arrival (tdoa) of matched filtered data</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="direction-finding-with-compact-volumetric-acoustic-sensor-cvas">
<h1>Direction finding with compact Volumetric Acoustic Sensor (cVAS)<a class="headerlink" href="#direction-finding-with-compact-volumetric-acoustic-sensor-cvas" title="Link to this heading">#</a></h1>
<p>The following script demonstrates different methods to estimate the direction of sound sources using a comapct volumetric acoustic sensor. Sound sources are simulated to provide the opportunity to assess the quality of the direction estimations.</p>
<p>note to myself: jupyter nbconvert cVAS_direction.ipynb –to html</p>
<section id="loading-libraries">
<h2>Loading libraries<a class="headerlink" href="#loading-libraries" title="Link to this heading">#</a></h2>
<p>First, some basic libraries are imported and general parameter defined.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>

<span class="kn">import</span> <span class="nn">bioacoustic_tools</span> <span class="k">as</span> <span class="nn">bat</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="c1">#</span>
<span class="nb">print</span><span class="p">(</span><span class="n">help</span><span class="p">(</span><span class="n">bat</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on module bioacoustic_tools:

NAME
    bioacoustic_tools

DESCRIPTION
    # %% [markdown]
    # # bioacoustic tools

CLASSES
    builtins.object
        MC

    class MC(builtins.object)
     |  MC(ho, hsel, sv)
     |
     |  Methods defined here:
     |
     |  __init__(self, ho, hsel, sv)
     |      Initialize self.  See help(type(self)) for accurate signature.
     |
     |  __proc_fft__(self, xx, nfft)
     |
     |  __quadInt__(self, uu, imx, nd1)
     |
     |  __str__(self)
     |      Return str(self).
     |
     |  beamform(self, ss, aze, ele, fs, nw, nfft, step=None)
     |
     |  directions(self, ss, fs, nw, step, nfft)
     |
     |  process(self, ss, fs, nw, step, nfft)
     |
     |  ----------------------------------------------------------------------
     |  Data descriptors defined here:
     |
     |  __dict__
     |      dictionary for instance variables
     |
     |  __weakref__
     |      list of weak references to the object

FUNCTIONS
    B_path(hd, sd, bd)

    D_path(hd, sd)

    S_path(hd, sd)

    arrayTransformer(ho, hsel)

    array_delay(S, ho, fs=None)

    beamForm(yy, DS)

    brownNoise(f)

    cosd(x)

    dirIntensity(xx, DI, hsel, fs, nw, nfft)

    dirPhase(ss, hsel, DI, nh=None)

    dirTDOA(ss, DI, hsel, nd=256)

    dirTDOA_0(zz, DI, hsel)

    dirTDOA_fast(ss, DI, hsel, nd=256)

    dirXcorr_stft(ss, fs, nw, nover, nfft, DI, hsel, nh)

    directionFinding(xx, DI, hsel, fs, nw=None, nfft=None, nh=None, method=None)
        estimates the direction of a sound source of array recordings
        parameters
            xx: multi-dimensional time series
            DI: hydrophone array mapping function
            fs: sampling frequency
            nw: size of processing window, defautls to 256
            nfft: fft size (if needed) defaults to window size
            nh: number of positive taps (if needed, e.g hilbert transform)
            method: processing method
                &#39;TDOA_0&#39;    : uses local maxima of whole tim series
                &#39;TDOA_fast&#39; : uses time series maxima (hilbert transform)
                &#39;TDOA&#39;      : uses fft based cross-correlation
                &#39;Phase&#39;     : uses local phase differences
                &#39;STFT&#39;      : uses spectrogram
                &#39;XCORR&#39;     : uses spectrogram to cross correlate (no overlap-add)

         returns:
            Azx:   Azimuth
            Elx:   Elevation
            t:     time axis
            f:     frequency axis (if applicable)
        #

    estIntensity(xx, DI, hsel, fs, nw, nfft)

    estPhase(ss, hsel, DI, nh=None)

    estTDOA(ss, DI, hsel, nd=256)

    estTDOA_0(zz, DI, hsel)

    estTDOA_fast(ss, DI, hsel, nd=256)

    estXcorr_stft(ss, fs, nw, nover, nfft, DI, hsel, nh)

    fft_filt(b, x, zi=None, nh=None)
        Filter multi-channel time series with an FIR filter

        Filter a data sequence, `x`, using a FIR filter given in `b`.
        Filtering uses the overlap-add method converting both `x` and `b`
        into frequency domain first.  The FFT size is determined as the
        next higher power of 2 of twice the length of `b`.

        Parameters
        ----------
        b : one-dimensional numpy array
            The impulse response of the filter
        x : numpy array
            Signal to be filtered
        zi : numpy array, optional
            Initial condition of the filter, but in reality just the
            runout of the previous computation.  If `zi` is None or not
            given, then zero initial state is assumed.
        nh : time shift of result (group delay) defaults to half the FIR filter

        Returns
        -------
        y : array
            The output of the digital filter.
        zf : array, optional
            If `zi` is None, this is not returned, otherwise, `zf` holds the
            final filter delay values.

    genNoise(N, fo, fs, method)

    getOctahedron(ro)

    getTetrahedron(ro)

    hilbert_filt(ss, nh)

    lfm(f1, f2, t2, fs)
        # %%

    matched_filt(xx, ss)

    pinkNoise(f)

    quadInt(uu, imx, nd1)
        #------------------------------------------------------------------

    quadInt1(C, infft, dn)

    shipNoise(f, fo)

    signalPath(dx, dy, az, ho)

    simMultiPath(hd, sd, dx, bd, az, ho, type)

    sim_array(yy, DS, noise)
        # %%

    sind(x)

    sinfm(fc, fm, fa, t2, fs)

    stack(x)

    tonal(fs, ax, fx)

    xcorr_fft(xx, hsel, method=None)

FILE
    c:\users\zimme\documents\bioacoustics\bioacoustic_tools.py


None
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># cVAS hydrophones</span>
<span class="n">ro</span><span class="o">=</span><span class="mf">0.040</span> <span class="c1"># m</span>
<span class="n">DI</span><span class="p">,</span><span class="n">ho</span><span class="p">,</span><span class="n">hsel</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">L</span><span class="o">=</span><span class="n">bat</span><span class="o">.</span><span class="n">getOctahedron</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="mf">0.75</span><span class="o">/</span><span class="n">L</span><span class="p">,</span><span class="s1">&#39;kHz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ 4.00000000e-02  0.00000000e+00 -2.82842712e-02]
 [-2.00000000e-02  3.46410162e-02 -2.82842712e-02]
 [-2.00000000e-02 -3.46410162e-02 -2.82842712e-02]
 [ 2.00000000e-02  3.46410162e-02  2.82842712e-02]
 [-4.00000000e-02  4.89858720e-18  2.82842712e-02]
 [ 2.00000000e-02 -3.46410162e-02  2.82842712e-02]]
[10.82531755 10.82531755 10.82531755  7.65465545 10.82531755 10.82531755
 10.82531755 10.82531755  7.65465545  7.65465545 10.82531755 10.82531755
 10.82531755 10.82531755 10.82531755] kHz
</pre></div>
</div>
</div>
</div>
<p>The print out presents the maximal frequencies that support phase-based operations. Dor 12 pairs the liniting frequency is 10.8 kHz, but for 3 pairs this upper frequency reduces to 7.6 kHz.</p>
</section>
<section id="simulation-of-cvas-sound-reception-from-a-deep-source-emitting-linear-frequency-modulated-lfm-signal">
<h2>Simulation of cVAS sound reception from a deep source emitting linear frequency modulated (LFM) signal.<a class="headerlink" href="#simulation-of-cvas-sound-reception-from-a-deep-source-emitting-linear-frequency-modulated-lfm-signal" title="Link to this heading">#</a></h2>
<p>The hydrophone measurements are simulated. Here a deep sound source emitting a 5 s LFM signal covering frequencies fro 0 to 24 kHz. The signal was choosen to cover twice the expected maximal bandwidth for coherent processing. As sampling frequency 96 kHz was choosen, to have  multiple samples at the upper boundary of the LFM signal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span><span class="o">=</span><span class="mi">96000</span>
<span class="n">f1</span><span class="o">=</span><span class="mi">1</span>
<span class="n">f2</span><span class="o">=</span><span class="mi">24000</span>
<span class="n">t2</span><span class="o">=</span><span class="mi">5</span>
<span class="n">sso</span><span class="o">=</span><span class="n">bat</span><span class="o">.</span><span class="n">tonal</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">bat</span><span class="o">.</span><span class="n">lfm</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">fs</span><span class="p">))</span>
<span class="n">tt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sso</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">fs</span>
<span class="n">ss</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">fs</span><span class="p">),</span><span class="n">sso</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">fs</span><span class="p">)))</span>
<span class="n">ts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">fs</span>

<span class="n">nw</span><span class="o">=</span><span class="mi">256</span>
<span class="n">f</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">Q</span><span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span><span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span><span class="n">nperseg</span><span class="o">=</span><span class="n">nw</span><span class="p">,</span><span class="n">noverlap</span><span class="o">=</span><span class="n">nw</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">nfft</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">nw</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">ext</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Q</span><span class="p">),</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">ext</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [kHz]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/47fd8e39395c3ed7e3b8e18751f7a7524362334b9bd2ac43d225e6b8beb0d9c2.png" src="_images/47fd8e39395c3ed7e3b8e18751f7a7524362334b9bd2ac43d225e6b8beb0d9c2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#simulate deep source</span>
<span class="n">az</span><span class="o">=</span><span class="mi">135</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
<span class="n">bd</span><span class="o">=</span><span class="mi">900</span> <span class="c1"># bottom depth m</span>
<span class="n">hd</span><span class="o">=</span><span class="mi">500</span> <span class="c1"># hydrophone depth m</span>
<span class="n">sd</span><span class="o">=</span><span class="mi">800</span> <span class="c1"># source depth m</span>
<span class="n">dx</span><span class="o">=</span><span class="mi">100</span> <span class="c1"># source distance m</span>

<span class="n">Tx</span><span class="p">,</span><span class="n">el</span><span class="p">,</span><span class="n">rx</span><span class="o">=</span><span class="n">bat</span><span class="o">.</span><span class="n">simMultiPath</span><span class="p">(</span><span class="n">hd</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">bd</span><span class="p">,</span><span class="n">az</span><span class="p">,</span><span class="n">ho</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>    <span class="c1"># Tx ms relative to array center</span>
<span class="n">DS</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Tx</span><span class="p">)</span><span class="o">*</span><span class="n">fs</span><span class="o">/</span><span class="mi">1000</span>                      <span class="c1"># DS samples from acoustic center</span>
<span class="nb">print</span><span class="p">(</span><span class="n">DS</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">noise</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">xx</span><span class="o">=</span><span class="n">bat</span><span class="o">.</span><span class="n">sim_array</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span><span class="n">DS</span><span class="p">,</span><span class="n">noise</span><span class="p">)</span>
<span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">0.4</span><span class="o">*</span><span class="n">xx</span><span class="o">/</span><span class="n">xx</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 1.1448668   2.49925878  1.50777504 -1.50777504 -1.1448668  -2.49925878]
</pre></div>
</div>
</div>
</div>
</section>
<section id="direction-finding-using-sound-intensity-vector">
<h2>Direction finding using sound intensity vector<a class="headerlink" href="#direction-finding-using-sound-intensity-vector" title="Link to this heading">#</a></h2>
<p>The implementation of the cVAS was diven by the observation that directionality of noise sources is best obtained by using sound intensity, which is a vector quantity. The following algorithm uses the spectrogram to obtain the sound intensity vector.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nw</span><span class="o">=</span><span class="mi">256</span>
<span class="n">nfft</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">nw</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">I</span> <span class="o">=</span> <span class="n">bat</span><span class="o">.</span><span class="n">directionFinding</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">DI</span><span class="p">,</span><span class="n">hsel</span><span class="p">,</span><span class="n">fs</span><span class="p">,</span><span class="n">nw</span><span class="p">,</span><span class="n">nfft</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;STFT&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">In</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">In</span><span class="p">[</span> <span class="mi">0</span><span class="p">,:]</span><span class="o">=</span><span class="n">In</span><span class="p">[</span> <span class="mi">1</span><span class="p">,:]</span>
<span class="n">In</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">In</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,:]</span>
<span class="n">J</span><span class="o">=</span><span class="n">I</span><span class="o">/</span><span class="n">In</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">In</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">In</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
<span class="n">In</span><span class="p">[</span> <span class="mi">0</span><span class="p">,:]</span><span class="o">=</span><span class="mi">0</span>
<span class="n">In</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="mi">0</span>
<span class="n">to</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ext</span><span class="o">=</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">im</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">In</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">ext</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Power&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">im</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">J</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span><span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;X-Component&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">im</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">J</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">],</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span><span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Y-Component&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>

<span class="n">im</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">J</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">],</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span><span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Z-Component&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>

<span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">axx</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
        <span class="n">axx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [kHz]&#39;</span><span class="p">)</span>
        <span class="n">axx</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mf">0.75</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">L</span><span class="p">),</span><span class="n">to</span><span class="p">,</span><span class="n">to</span><span class="o">+</span><span class="n">t2</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">axx</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mf">0.75</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">L</span><span class="p">),</span><span class="n">to</span><span class="p">,</span><span class="n">to</span><span class="o">+</span><span class="n">t2</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">yl</span><span class="o">=</span><span class="p">[]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yl</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">axx</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
        <span class="n">axx</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yl</span><span class="p">)</span>

<span class="n">xto</span><span class="o">=</span><span class="kc">None</span>
<span class="n">xto</span><span class="o">=-</span><span class="mf">0.5</span>
<span class="k">if</span> <span class="n">xto</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> 
    <span class="k">for</span> <span class="n">axx</span><span class="p">,</span><span class="n">itxt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">))):</span>
        <span class="n">axx</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xto</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="nb">chr</span><span class="p">(</span><span class="n">itxt</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">im</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">In</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">ext</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Power&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">im</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span><span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Azimuth&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">im</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span><span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Elevation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>

<span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">axx</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
        <span class="n">axx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [kHz]&#39;</span><span class="p">)</span>
        <span class="n">axx</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mf">0.75</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">L</span><span class="p">),</span><span class="n">to</span><span class="p">,</span><span class="n">to</span><span class="o">+</span><span class="n">t2</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">axx</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mf">0.75</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">L</span><span class="p">),</span><span class="n">to</span><span class="p">,</span><span class="n">to</span><span class="o">+</span><span class="n">t2</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">yl</span><span class="o">=</span><span class="p">[]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yl</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">axx</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
        <span class="n">axx</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yl</span><span class="p">)</span>

<span class="n">xto</span><span class="o">=</span><span class="kc">None</span>
<span class="n">xto</span><span class="o">=-</span><span class="mf">0.5</span>
<span class="k">if</span> <span class="n">xto</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> 
    <span class="k">for</span> <span class="n">axx</span><span class="p">,</span><span class="n">itxt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">))):</span>
        <span class="n">axx</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xto</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="nb">chr</span><span class="p">(</span><span class="n">itxt</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6776a75b7d79ea622ce806e9d38767daf4197f0afdbeeae10fa001f43ea66235.png" src="_images/6776a75b7d79ea622ce806e9d38767daf4197f0afdbeeae10fa001f43ea66235.png" />
<img alt="_images/41422a14fa347e15becb89c81a41be998bc464af48c45a51b856d629763cc952.png" src="_images/41422a14fa347e15becb89c81a41be998bc464af48c45a51b856d629763cc952.png" />
</div>
</div>
<p>The figure shows the estimated azimuth and elevation angles as function of frequency versus time. The two horizontal dashed lines indicate the two spectral limits where phase-based operations are unique. The lower line considers all hydrophone pairs (including the 3 longer cross-diagonal ones) and the upper line corresonds to the 12 ‘normal’ hydrophone pairs.</p>
</section>
<section id="direction-finding-using-phase-differences">
<h2>Direction finding using phase differences<a class="headerlink" href="#direction-finding-using-phase-differences" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">azx</span><span class="p">,</span><span class="n">elx</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">bat</span><span class="o">.</span><span class="n">directionFinding</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">DI</span><span class="p">,</span><span class="n">hsel</span><span class="p">,</span><span class="n">fs</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;Phase&#39;</span><span class="p">)</span>

<span class="n">fr</span><span class="o">=</span><span class="n">f1</span><span class="o">+</span><span class="p">(</span><span class="n">f2</span><span class="o">-</span><span class="n">f1</span><span class="p">)</span><span class="o">*</span><span class="n">tt</span><span class="o">/</span><span class="n">t2</span>
<span class="n">ifr</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">to</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fr</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
<span class="n">frk</span><span class="o">=</span><span class="n">fr</span><span class="o">/</span><span class="mi">1000</span>

<span class="k">def</span> <span class="nf">Angle_plot</span><span class="p">(</span><span class="n">frx</span><span class="p">,</span><span class="n">azx</span><span class="p">,</span><span class="n">elx</span><span class="p">,</span><span class="n">Lm</span><span class="p">,</span><span class="n">scale</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s2">&quot;figsize&quot;</span><span class="p">,[</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frx</span><span class="p">,</span><span class="n">azx</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;az&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frx</span><span class="p">,</span><span class="n">elx</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;el&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frx</span><span class="p">,</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">az</span><span class="o">+</span><span class="mi">0</span><span class="o">*</span><span class="n">frx</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frx</span><span class="p">,</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">el</span><span class="o">+</span><span class="mi">0</span><span class="o">*</span><span class="n">frx</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Lm</span><span class="p">),</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Lm</span><span class="p">),</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="c1">#plt.xlim(1e-4,24)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency [kHz]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Angle [°]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">Angle_plot</span><span class="p">(</span><span class="n">frk</span><span class="p">,</span><span class="n">azx</span><span class="p">[</span><span class="n">ifr</span><span class="p">],</span><span class="n">elx</span><span class="p">[</span><span class="n">ifr</span><span class="p">],</span><span class="mf">0.75</span><span class="o">/</span><span class="n">L</span><span class="p">,</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">Angle_plot</span><span class="p">(</span><span class="n">frk</span><span class="p">,</span><span class="n">azx</span><span class="p">[</span><span class="n">ifr</span><span class="p">],</span><span class="n">elx</span><span class="p">[</span><span class="n">ifr</span><span class="p">],</span><span class="mf">0.75</span><span class="o">/</span><span class="n">L</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/69dccfed6595480b6fff5c570aaeed88c0039a09033e7625c9f937d6fe14ebd2.png" src="_images/69dccfed6595480b6fff5c570aaeed88c0039a09033e7625c9f937d6fe14ebd2.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\zimme\miniconda3\envs\cVAS\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/74264d020f222a53d177a486ed36e3ff1e4fad93fdb964ff85d52cf964992b50.png" src="_images/74264d020f222a53d177a486ed36e3ff1e4fad93fdb964ff85d52cf964992b50.png" />
</div>
</div>
</section>
<section id="direction-finding-using-hydrophone-spectrogram-based-cross-correlation">
<h2>Direction finding using hydrophone spectrogram based cross correlation<a class="headerlink" href="#direction-finding-using-hydrophone-spectrogram-based-cross-correlation" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nh</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="mi">1500</span><span class="o">*</span><span class="n">fs</span><span class="p">)))</span> 
<span class="n">nw</span><span class="o">=</span><span class="mi">256</span>
<span class="n">azx</span><span class="p">,</span><span class="n">elx</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="n">bat</span><span class="o">.</span><span class="n">directionFinding</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">DI</span><span class="p">,</span><span class="n">hsel</span><span class="p">,</span><span class="n">fs</span><span class="p">,</span><span class="n">nw</span><span class="o">=</span><span class="n">nw</span><span class="p">,</span><span class="n">nfft</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">nw</span><span class="p">,</span><span class="n">nh</span><span class="o">=</span><span class="n">nh</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;XCORR&quot;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">nstep</span><span class="o">=</span><span class="n">nw</span><span class="o">//</span><span class="mi">2</span>
<span class="n">fx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fx</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">to</span><span class="o">*</span><span class="n">fs</span><span class="p">)]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">fx</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">to</span><span class="o">*</span><span class="n">fs</span><span class="p">):</span><span class="nb">int</span><span class="p">((</span><span class="n">to</span><span class="o">+</span><span class="n">t2</span><span class="p">)</span><span class="o">*</span><span class="n">fs</span><span class="p">)]</span><span class="o">=</span><span class="n">fr</span>
<span class="n">fx</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">to</span><span class="o">+</span><span class="n">t2</span><span class="p">)</span><span class="o">*</span><span class="n">fs</span><span class="p">):]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">fx1</span><span class="o">=</span><span class="n">fx</span><span class="p">[::</span><span class="n">nstep</span><span class="p">]</span>

<span class="n">ifr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fx1</span><span class="p">))</span>
<span class="n">frk</span><span class="o">=</span><span class="n">fx1</span><span class="p">[</span><span class="n">ifr</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>

<span class="n">Angle_plot</span><span class="p">(</span><span class="n">frk</span><span class="p">,</span><span class="n">azx</span><span class="p">[</span><span class="n">ifr</span><span class="p">],</span><span class="n">elx</span><span class="p">[</span><span class="n">ifr</span><span class="p">],</span><span class="mf">0.75</span><span class="o">/</span><span class="n">L</span><span class="p">,</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">Angle_plot</span><span class="p">(</span><span class="n">frk</span><span class="p">,</span><span class="n">azx</span><span class="p">[</span><span class="n">ifr</span><span class="p">],</span><span class="n">elx</span><span class="p">[</span><span class="n">ifr</span><span class="p">],</span><span class="mf">0.75</span><span class="o">/</span><span class="n">L</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/60df6c3914122f11ff2980e7abdd9f07a1ca3c19be6dd46dfe4ac6db340d2524.png" src="_images/60df6c3914122f11ff2980e7abdd9f07a1ca3c19be6dd46dfe4ac6db340d2524.png" />
<img alt="_images/6af41aa455a027429226bcd5d98581e9628439407eead732da623729bf413332.png" src="_images/6af41aa455a027429226bcd5d98581e9628439407eead732da623729bf413332.png" />
</div>
</div>
</section>
<section id="direction-finding-using-time-delay-of-arrival-tdoa-of-matched-filtered-data">
<h2>Direction finding using time-delay-of-arrival (tdoa) of matched filtered data<a class="headerlink" href="#direction-finding-using-time-delay-of-arrival-tdoa-of-matched-filtered-data" title="Link to this heading">#</a></h2>
<p>As the signal is simulated as a linear frequency modulated time series, it is appropriate to pre-process the data using a matched filter to compress the signal into sharp transients. Using these shortened signals, standard time-delay-of arrival (tdoa) methods can be applied to obtain the direction of the sound source.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># matched filter of generated signal</span>
<span class="n">zz</span><span class="o">=</span><span class="n">bat</span><span class="o">.</span><span class="n">matched_filt</span><span class="p">(</span><span class="n">sso</span><span class="p">,</span><span class="n">xx</span><span class="p">)</span>

<span class="n">azx</span><span class="p">,</span><span class="n">elx</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">ux</span><span class="o">=</span><span class="n">bat</span><span class="o">.</span><span class="n">directionFinding</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span><span class="n">DI</span><span class="p">,</span><span class="n">hsel</span><span class="p">,</span><span class="n">fs</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;TDOA_0&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">azx</span><span class="p">,</span><span class="n">elx</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">az</span><span class="p">,</span><span class="n">el</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="n">tux</span><span class="o">=</span><span class="n">ux</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">fs</span>

<span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="o">=</span><span class="n">zz</span><span class="o">.</span><span class="n">shape</span>
<span class="n">n3</span><span class="o">=</span><span class="n">ux</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">ts</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tux</span><span class="p">))</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="n">zz</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="n">n2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">tux</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tux</span><span class="p">))</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="n">ux</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n3</span><span class="p">),</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [ms]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>135.71845148771868 -71.37048304171563
[135.         -71.56505118]
</pre></div>
</div>
<img alt="_images/174ca41f58754233b7a16c636114d00901f91515bce879f2d91d612e055b18ed.png" src="_images/174ca41f58754233b7a16c636114d00901f91515bce879f2d91d612e055b18ed.png" />
</div>
</div>
<p>The figure shows the output of the matched filter for all hydrophones and the time delays are clearly visible. For each of the transient the time of the maximum was obtained by quadratic interpolation of 3 relevant samples. The estimated sound direction (azimuth and elevation)  are very close to the simulated one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aze</span><span class="o">=</span><span class="n">azx</span>
<span class="n">ele</span><span class="o">=</span><span class="n">elx</span>
<span class="nb">print</span><span class="p">(</span><span class="n">aze</span><span class="p">,</span><span class="n">ele</span><span class="p">)</span>

<span class="n">sv</span><span class="o">=</span><span class="mi">1500</span>
<span class="n">mc</span><span class="o">=</span><span class="n">bat</span><span class="o">.</span><span class="n">MC</span><span class="p">(</span><span class="n">ho</span><span class="p">,</span><span class="n">hsel</span><span class="p">,</span><span class="n">sv</span><span class="p">)</span>
<span class="c1">#</span>

<span class="n">nw</span><span class="o">=</span><span class="mi">256</span>
<span class="n">nstep</span><span class="o">=</span><span class="mi">128</span>
<span class="n">nfft</span><span class="o">=</span><span class="mi">512</span>
<span class="n">uu</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">beamform</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span><span class="n">aze</span><span class="p">,</span><span class="n">ele</span><span class="p">,</span><span class="n">fs</span><span class="p">,</span><span class="n">nw</span><span class="p">,</span><span class="n">nfft</span><span class="p">)</span>     <span class="c1"># long time series</span>


<span class="c1">#def stack(x): return x+np.ones((x.shape[0],1))*range(x.shape[1])</span>
<span class="n">tso</span><span class="o">=</span><span class="mf">3.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="o">-</span><span class="n">tso</span><span class="p">,</span><span class="n">bat</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">zz</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="o">-</span><span class="n">tso</span><span class="p">,</span><span class="n">uu</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0005</span><span class="p">,</span><span class="mf">0.0005</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>135.71845148771868 -71.37048304171563
</pre></div>
</div>
<img alt="_images/6da5e821bbd7f4957afcac0b73449aafb705ecd8d563f78c1c59638f0a8367e4.png" src="_images/6da5e821bbd7f4957afcac0b73449aafb705ecd8d563f78c1c59638f0a8367e4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">io</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">3.5</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">-</span><span class="mi">128</span>
<span class="n">zzz</span><span class="o">=</span><span class="n">zz</span><span class="p">[</span><span class="n">io</span><span class="p">:</span><span class="n">io</span><span class="o">+</span><span class="mi">256</span><span class="p">,:]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span><span class="n">bat</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">zzz</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">5e-4</span><span class="p">,</span><span class="mf">5e-4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">uu</span><span class="p">,</span><span class="n">uuo</span><span class="o">=</span><span class="n">mc</span><span class="o">.</span><span class="n">beamform</span><span class="p">(</span><span class="n">zzz</span><span class="p">,</span><span class="n">aze</span><span class="p">,</span><span class="n">ele</span><span class="p">,</span><span class="n">fs</span><span class="p">,</span><span class="n">nw</span><span class="p">,</span><span class="n">nfft</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># signle data snippet</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span><span class="n">bat</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">uuo</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span><span class="n">uu</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">5e-4</span><span class="p">,</span><span class="mf">5e-4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6c99488f2a999ddbd24dbd64f85faa0a4891929c3c9e29eb3b918c7dd372ef07.png" src="_images/6c99488f2a999ddbd24dbd64f85faa0a4891929c3c9e29eb3b918c7dd372ef07.png" />
<img alt="_images/2414017be155a77427b26494dfa73dbe2b595b000f5a77557dfe386b9f5bf436.png" src="_images/2414017be155a77427b26494dfa73dbe2b595b000f5a77557dfe386b9f5bf436.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="bioacoustic_tools.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">bioacoustic tools</p>
      </div>
    </a>
    <a class="right-next"
       href="Click_train_detector.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Click train detector</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-libraries">Loading libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-of-cvas-sound-reception-from-a-deep-source-emitting-linear-frequency-modulated-lfm-signal">Simulation of cVAS sound reception from a deep source emitting linear frequency modulated (LFM) signal.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direction-finding-using-sound-intensity-vector">Direction finding using sound intensity vector</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direction-finding-using-phase-differences">Direction finding using phase differences</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direction-finding-using-hydrophone-spectrogram-based-cross-correlation">Direction finding using hydrophone spectrogram based cross correlation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direction-finding-using-time-delay-of-arrival-tdoa-of-matched-filtered-data">Direction finding using time-delay-of-arrival (tdoa) of matched filtered data</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Walter MX Zimmer
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>