
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Direction Finding &#8212; bioacoustics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Misc/direction_finding';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">bioacoustics</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Bioacoustics by WMXZ
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">General Bioacoustics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../wave_equation.html">Wave equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Zc_click.html">Cuvierâ€™s beaked whale click</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power_spectra.html">Spectral estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound_intensity.html">Sound Intensity</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Processing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../transient_detection.html">Transient detections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../multi-phone-localization.html">Multi-phone localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beamforming.html">Beamforming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../multi-channel-processing.html">Multi channel processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ray_tracing.html">Ray tracing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">cVAS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../cVAS_direction.html">Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cVAS_phase_direction.html">cVAS phase direction finding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cVAS_stft_direction.html">cVAS stft direction finding</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Work in Progress</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Click_train_detector.html">Click train detector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Detections.html">Click detection</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Bar La Mare</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../BLM/blm_0.html">BML_0: BAR_LA_MARE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BLM/blm_1.html">BLM_1: Basic signal spectral analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BLM/blm_2.html">BLM_2:  Wave propagation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BLM/blm_3.html">BLM_3: Underwater Sound Propagation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BLM/blm_4.html">BLM_4: Spectrogram</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/wmxz-eu/wmxz-eu.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/wmxz-eu/wmxz-eu.github.io/issues/new?title=Issue%20on%20page%20%2FMisc/direction_finding.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Misc/direction_finding.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Direction Finding</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-formulation">Basic formulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#angle-estimations">Angle estimations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-delay-based-direction-finding">Time delay based direction finding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#intensity-based-direction-finding">Intensity based direction finding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phase-based-direction-finding">phase based direction finding</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation">Simulation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="direction-finding">
<h1>Direction Finding<a class="headerlink" href="#direction-finding" title="Link to this heading">#</a></h1>
<p>The direction of the sound source is here estimated by determining for the same signal the relative delays between the different hydrophones and by considering the following relation between measured delays and the direction vector of the sound source.</p>
<p>The minimal number of hydrophones to form a volumetric array is 4 allowing to form n = 6 different hydrophone pairs.
To obtain an optimal volumetric array the hydrophones are located on the tips of an tetrahedron. This way all 6 hydrophone pairs have the same separation.
While direction finding could be done with only 3 hydrophone pairs, the use of all 6 different combinations should improve the performance, as the impact of measurement errors is reduced.
This is reflected by the Least-Mean-Square notation in equation.
Also, using all possible hydrophone pairs puts the reference location of the array automatically in the center of the array eliminating the need for a selection of a reference hydrophone.</p>
<p>A volumetric array with 6 hydrophones allows the formation of n = 15 different pairs of hydrophones. If the hydrophones are located on the tips of an octohedron, 12 of the 15 hydrophone pairs have the same length, and 3 are slightly longer.</p>
<section id="basic-formulation">
<h2>Basic formulation<a class="headerlink" href="#basic-formulation" title="Link to this heading">#</a></h2>
<p>Let the sound direction  <span class="math notranslate nohighlight">\(\hat s\)</span> be given by</p>
<div class="amsmath math notranslate nohighlight" id="equation-6656e1dc-127c-4d2f-bfd3-6f8b4d63c74c">
<span class="eqno">()<a class="headerlink" href="#equation-6656e1dc-127c-4d2f-bfd3-6f8b4d63c74c" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \hat s = 
    \left(
        \begin{array}{c}
            s_x\\
            s_y\\
            s_z
        \end{array}
    \right)  
\end{equation}\]</div>
<p>and the hydrophone separation matrix <span class="math notranslate nohighlight">\( D_0\)</span> be given by</p>
<div class="amsmath math notranslate nohighlight" id="equation-b6bd272b-835a-4946-a16b-3c931e64fee6">
<span class="eqno">()<a class="headerlink" href="#equation-b6bd272b-835a-4946-a16b-3c931e64fee6" title="Permalink to this equation">#</a></span>\[\begin{equation}
     D_0 = 
    \left(
        \begin{array}{c c c c}
            d_{1x} &amp; d_{2x} &amp; ... &amp; d_{nx}\\
            d_{1y} &amp; d_{2y} &amp; ... &amp; d_{ny}\\
            d_{1z} &amp; d_{2z} &amp; ... &amp; d_{nz}\\
        \end{array}
    \right)  
\end{equation}\]</div>
<p>where the elements <span class="math notranslate nohighlight">\((d_{ix},d_{iy},d_{iz}) \)</span> are the <span class="math notranslate nohighlight">\(x,y,z\)</span> components of the vector that connects a pair of hydrophones.</p>
<p>then the vector of measurements <span class="math notranslate nohighlight">\( m\)</span> defined by</p>
<div class="amsmath math notranslate nohighlight" id="equation-1854a709-2418-41d2-907f-a809072d8a56">
<span class="eqno">()<a class="headerlink" href="#equation-1854a709-2418-41d2-907f-a809072d8a56" title="Permalink to this equation">#</a></span>\[\begin{equation}
     m = 
    \left(
        \begin{array}{c}
            m_1\\
            m_2\\
            \vdots\\
            m_n
        \end{array}
    \right)  
\end{equation}\]</div>
<p>is estimated by the projection of the sound source direction onto the different hydrophone pairs.</p>
<div class="amsmath math notranslate nohighlight" id="equation-bf255361-d2b8-405a-8cf2-78b2439ffc9e">
<span class="eqno">()<a class="headerlink" href="#equation-bf255361-d2b8-405a-8cf2-78b2439ffc9e" title="Permalink to this equation">#</a></span>\[\begin{equation}
     m =  D_0^T  {\hat s}
\end{equation}\]</div>
<p>The sound direction is then estimated from the measurement vector by</p>
<div class="amsmath math notranslate nohighlight" id="equation-2f161966-cb6e-4fbf-818f-f5e0245f4192">
<span class="eqno">()<a class="headerlink" href="#equation-2f161966-cb6e-4fbf-818f-f5e0245f4192" title="Permalink to this equation">#</a></span>\[\begin{equation}
    {\hat s} = \left( D_0^T  D_0 \right)^{-1}  D_0  m
\end{equation}\]</div>
</section>
<section id="angle-estimations">
<h2>Angle estimations<a class="headerlink" href="#angle-estimations" title="Link to this heading">#</a></h2>
<p>The arrival angles azimuth <span class="math notranslate nohighlight">\(\alpha\)</span> and elevation <span class="math notranslate nohighlight">\(\beta\)</span>  of the sound are finally estimated by solving</p>
<div class="amsmath math notranslate nohighlight" id="equation-88ae2718-f9d5-406c-a90f-6dac35c1a108">
<span class="eqno">()<a class="headerlink" href="#equation-88ae2718-f9d5-406c-a90f-6dac35c1a108" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \tan \alpha = \frac{-s_y}{s_x}
\end{equation}\]</div>
<p>and</p>
<div class="amsmath math notranslate nohighlight" id="equation-066f46ac-a786-4bb7-a249-6cbfd0cc054f">
<span class="eqno">()<a class="headerlink" href="#equation-066f46ac-a786-4bb7-a249-6cbfd0cc054f" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \sin \beta = s_z
\end{equation}\]</div>
<p>or alternatively</p>
<div class="amsmath math notranslate nohighlight" id="equation-fab58e29-da9a-47e9-9887-6156eda8a550">
<span class="eqno">()<a class="headerlink" href="#equation-fab58e29-da9a-47e9-9887-6156eda8a550" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \tan \beta = \frac{s_z}{\sqrt{s_x^2+s_y^2}}
\end{equation}\]</div>
<p>As the azimuth angles may vary from -180Â°  to 180Â°  the solutions require the usual care for  <span class="math notranslate nohighlight">\(s_x&lt;0\)</span>, i.e. by using the four-quadrant inverse tangent.
The minus sign in equation is simply due to the convention that positive azimuth is measured towards starboard.</p>
<p>As the elevation angle <span class="math notranslate nohighlight">\(\beta\)</span> is restricted to Â±90Â°, an ordinary inverse sinus is sufficient but a four-quadrant inverse tangent seems also here preferred because it is insensitive to a common factor (e.g. uncertain sound speed at the array).</p>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">#</a></h2>
<p>The following function demonstrates the generation of the matrix <span class="math notranslate nohighlight">\(DI = \left( D_0^T  D_0 \right)^{-1}  D_0\)</span> that is multiplied with the measurement vector to obtain the sound direction.</p>
<p>The two hydrophone arrays are two systems that have been used (cPAM) or are in use by the author (cVAS).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">hydrophones</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;cVAS&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">==</span><span class="s1">&#39;cVAS&#39;</span><span class="p">:</span>
        <span class="c1"># cVAS hydrophones</span>
        <span class="c1"># octahedron (x points from &#39;centre&#39; towards hydrophone 1)</span>
        <span class="n">ro</span><span class="o">=</span><span class="mf">0.040</span> <span class="c1"># m</span>
        <span class="n">dz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ang</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">240</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">300</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
        <span class="c1">#</span>
        <span class="n">ho</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ang</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">ho</span><span class="p">[:,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">[:]),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[:]),</span><span class="o">-</span><span class="n">dz</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">0</span><span class="o">*</span><span class="n">ang</span><span class="p">[:]])</span>
        <span class="n">ho</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dz</span>
        <span class="n">ho</span> <span class="o">*=</span> <span class="n">ro</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">==</span><span class="s1">&#39;cPAM&#39;</span><span class="p">:</span>
        <span class="c1"># cPAM hydrophones</span>
        <span class="c1"># tripple towed array (x points forward, &#39;towards hydrophone 1)</span>
        <span class="n">ro</span><span class="o">=</span><span class="mf">0.56</span><span class="p">;</span>
        <span class="n">dz</span><span class="o">=</span><span class="mf">1.0</span><span class="p">;</span>
        <span class="n">ang</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">;</span>
        <span class="c1">#</span>
        <span class="n">ho</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ang</span><span class="p">),</span><span class="mi">3</span><span class="p">));</span>
        <span class="n">ho</span><span class="p">[:,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">dz</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">0</span><span class="o">*</span><span class="n">ang</span><span class="p">[:],</span><span class="n">ro</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[:]),</span><span class="n">ro</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">[:])]);</span>
        <span class="n">ho</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">dz</span><span class="p">;</span>        
    <span class="c1">#</span>
    <span class="n">isel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span>

    <span class="p">[</span><span class="n">nc</span><span class="p">,</span><span class="n">_</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">isel</span><span class="p">)</span>
    <span class="c1">#print(nc)</span>

    <span class="n">D</span><span class="o">=</span><span class="n">ho</span><span class="p">[</span><span class="n">isel</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],]</span><span class="o">-</span><span class="n">ho</span><span class="p">[</span><span class="n">isel</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],]</span>
    <span class="n">L</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">D</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1">#print(L)</span>
    <span class="n">DI</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">isel</span><span class="p">,</span><span class="n">DI</span><span class="p">,</span><span class="n">nc</span><span class="p">,</span><span class="n">ho</span>
</pre></div>
</div>
</div>
</div>
<section id="time-delay-based-direction-finding">
<h3>Time delay based direction finding<a class="headerlink" href="#time-delay-based-direction-finding" title="Link to this heading">#</a></h3>
<p>For a time delay based direction finding one uses as measurements</p>
<div class="amsmath math notranslate nohighlight" id="equation-be6261f1-c118-4d3d-87b0-00806d7f4248">
<span class="eqno">()<a class="headerlink" href="#equation-be6261f1-c118-4d3d-87b0-00806d7f4248" title="Permalink to this equation">#</a></span>\[\begin{equation}
     m_i = c \Delta \tau_i
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(c\)</span> is the sound speed between the a pair of hydrophones,</p>
</section>
<section id="intensity-based-direction-finding">
<h3>Intensity based direction finding<a class="headerlink" href="#intensity-based-direction-finding" title="Link to this heading">#</a></h3>
<p>Using the estimated (spectral) sound intensity along a pair of hydrophones, say <span class="math notranslate nohighlight">\(I_i(f)\)</span> then suitable measurements are</p>
<div class="amsmath math notranslate nohighlight" id="equation-edec1816-3467-45aa-8aaf-38b6bb3fdc9c">
<span class="eqno">()<a class="headerlink" href="#equation-edec1816-3467-45aa-8aaf-38b6bb3fdc9c" title="Permalink to this equation">#</a></span>\[\begin{equation}
m_i = \Delta x_{12}I_i(f)    =-\frac{1}{\rho} \frac{\text{Im}\{P_{i2}(\omega) P_{i1}^* (\omega)\}}{\omega}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(P_{i1}(\omega)\)</span> and <span class="math notranslate nohighlight">\(P_{i2}(\omega)\)</span> are the (complex valued) power spectra of a pair of hydrophones and <span class="math notranslate nohighlight">\(\Delta x_{12}\)</span> id the distance between the two hydrophones.</p>
<p>Intensity based direction finding is spectral based and therefore limited to lower frequencies <span class="math notranslate nohighlight">\(k\omega &lt; 2/d\)</span>, where <span class="math notranslate nohighlight">\(d\)</span> is the maximal hydrophone spacing</p>
</section>
<section id="phase-based-direction-finding">
<h3>phase based direction finding<a class="headerlink" href="#phase-based-direction-finding" title="Link to this heading">#</a></h3>
<p>For lower frequencies,  <span class="math notranslate nohighlight">\(k\omega &lt; 2/d\)</span>, phase differences between pairs of hydrophones can be used for direction finding.</p>
<div class="amsmath math notranslate nohighlight" id="equation-9af1367a-8e1e-4327-9e75-653e3dd85929">
<span class="eqno">()<a class="headerlink" href="#equation-9af1367a-8e1e-4327-9e75-653e3dd85929" title="Permalink to this equation">#</a></span>\[\begin{equation}
m_i = \Delta x_{12}\Phi(\omega)
\end{equation}\]</div>
<p>where</p>
<div class="amsmath math notranslate nohighlight" id="equation-bb1b3b66-7b27-455c-8edd-e436321e9432">
<span class="eqno">()<a class="headerlink" href="#equation-bb1b3b66-7b27-455c-8edd-e436321e9432" title="Permalink to this equation">#</a></span>\[\begin{equation}
\Phi(\omega) = -\text{Im}\{\text{log}_e(P_{i2}(\omega) P_{i1}^* (\omega))\}
\end{equation}\]</div>
</section>
</section>
<section id="simulation">
<h2>Simulation<a class="headerlink" href="#simulation" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">zcSig</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">fm</span><span class="p">,</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">cc</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">aa</span><span class="o">*</span><span class="n">tt</span><span class="p">)</span><span class="o">**</span><span class="n">bb</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">aa</span><span class="o">*</span><span class="n">tt</span><span class="p">)</span><span class="o">**</span><span class="n">cc</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">f0</span><span class="o">+</span><span class="n">fm</span><span class="o">*</span><span class="n">tt</span><span class="p">)</span><span class="o">*</span><span class="n">tt</span><span class="p">)</span>

<span class="n">fs</span><span class="o">=</span><span class="mi">192</span> <span class="c1">#kHz</span>
<span class="n">ts</span><span class="o">=</span><span class="mf">0.3</span> <span class="c1">#ms</span>
<span class="n">tt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ts</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>

<span class="n">f0</span><span class="o">=</span><span class="mi">30</span>
<span class="n">fm</span><span class="o">=</span><span class="mi">60</span>
<span class="n">aa</span><span class="o">=</span><span class="mi">13</span>
<span class="n">bb</span><span class="o">=</span><span class="mf">1.5</span>
<span class="n">cc</span><span class="o">=</span><span class="mf">1.5</span>
<span class="n">ss</span><span class="o">=</span><span class="n">zcSig</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">fm</span><span class="p">,</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">cc</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ss</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ss</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/31c4701a7129958f153b46d180628aa1395214fd6eda91f9c459167d3d49f9ea.png" src="../_images/31c4701a7129958f153b46d180628aa1395214fd6eda91f9c459167d3d49f9ea.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># hydrophones</span>

<span class="n">isel</span><span class="p">,</span><span class="n">DI</span><span class="p">,</span><span class="n">nc</span><span class="p">,</span><span class="n">ho</span> <span class="o">=</span> <span class="n">hydrophones</span><span class="p">(</span><span class="s1">&#39;cVAS&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">=</span><span class="mi">0</span>
<span class="n">bd</span><span class="o">=</span><span class="mi">900</span> <span class="c1">#m</span>
<span class="n">hd</span><span class="o">=</span><span class="mi">500</span> <span class="c1">#m</span>
<span class="n">sd</span><span class="o">=</span><span class="mi">800</span> <span class="c1">#m</span>
<span class="n">dx</span><span class="o">=</span><span class="mi">5000</span> <span class="c1">#m</span>
<span class="c1">#</span>
<span class="n">r1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">hd</span><span class="o">-</span><span class="n">sd</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">r2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">hd</span><span class="o">+</span><span class="n">sd</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">dr</span> <span class="o">=</span> <span class="n">r2</span><span class="o">-</span><span class="n">r1</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">dr</span><span class="o">/</span><span class="mf">1.5</span>

<span class="n">a1</span><span class="o">=</span><span class="mi">1</span>
<span class="n">a2</span><span class="o">=-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">r1</span><span class="o">/</span><span class="n">r2</span>

<span class="n">el1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">hd</span><span class="o">-</span><span class="n">sd</span><span class="p">,</span><span class="n">dx</span><span class="p">)</span>
<span class="n">el2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">hd</span><span class="o">+</span><span class="n">sd</span><span class="p">,</span><span class="n">dx</span><span class="p">)</span>

<span class="c1">#print(np.array([r1,r2,dr,dt]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Angles: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">az</span><span class="p">,</span><span class="n">el1</span><span class="p">,</span><span class="n">el2</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time delay: &#39;</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Angles:  [ 0.         -3.43363036 14.5742162 ]
Time delay:  104.82975112567874
</pre></div>
</div>
</div>
</div>
<p>Simulate now the time delays of the hydrophone measurements that one should expect for given source geometry and acoustic paths</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#hydrophone delay simulation</span>
<span class="n">S1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">az</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">el1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">az</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">el1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">el1</span><span class="p">)])</span>
<span class="n">S2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">az</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">el2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">az</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">el2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">el2</span><span class="p">)])</span>
<span class="n">DC1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ho</span><span class="o">*</span><span class="n">S1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">DC2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ho</span><span class="o">*</span><span class="n">S2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">DT1</span><span class="o">=</span><span class="n">DC1</span><span class="o">/</span><span class="mf">1.500</span>
<span class="n">DT2</span><span class="o">=</span><span class="n">DC2</span><span class="o">/</span><span class="mf">1.500</span>
</pre></div>
</div>
</div>
</div>
<p>define and check fractional signal delay</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>

<span class="n">fs</span><span class="o">=</span><span class="mi">192</span> <span class="c1">#kHz</span>
<span class="n">ts</span><span class="o">=</span><span class="mf">0.5</span> <span class="c1">#ms</span>
<span class="n">tt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ts</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>

<span class="n">f0</span><span class="o">=</span><span class="mi">30</span>
<span class="n">fm</span><span class="o">=</span><span class="mi">60</span>
<span class="n">aa</span><span class="o">=</span><span class="mi">13</span>
<span class="n">bb</span><span class="o">=</span><span class="mf">1.5</span>
<span class="n">cc</span><span class="o">=</span><span class="mf">1.5</span>
<span class="n">ss</span><span class="o">=</span><span class="n">zcSig</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">fm</span><span class="p">,</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">cc</span><span class="p">)</span>

<span class="c1">#see also http://www.labbookpages.co.uk/audio/beamforming/fractionalDelay.html#filter</span>
<span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">tau</span><span class="p">):</span>
    <span class="c1">#tau = -4.5 # Fractional delay [samples].</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">21</span>     <span class="c1"># Filter length.</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    
    <span class="c1"># Compute sinc filter.</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">tau</span><span class="p">)</span>
    
    <span class="c1"># Multiply sinc filter by window</span>
    <span class="n">h</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">blackman</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    
    <span class="c1"># Normalize to get unity gain.</span>
    <span class="n">h</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="n">uu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xx</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10</span><span class="p">,)))</span>

    <span class="n">yy</span><span class="o">=</span><span class="n">signal</span><span class="o">.</span><span class="n">lfilter</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">uu</span><span class="p">);</span> <span class="n">yy</span><span class="o">=</span><span class="n">yy</span><span class="p">[</span><span class="mi">10</span><span class="p">:,]</span>
    <span class="k">return</span> <span class="n">yy</span>

<span class="n">uu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">20</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ss</span><span class="p">)))</span>
<span class="n">tu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uu</span><span class="p">))</span><span class="o">/</span><span class="n">fs</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">,[</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">dto</span><span class="o">=</span><span class="mi">1</span>
<span class="n">x0</span><span class="o">=</span><span class="n">delay</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tu</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="s1">&#39;.-&#39;</span><span class="p">)</span>

<span class="n">x1</span><span class="o">=</span><span class="n">delay</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span><span class="o">+</span><span class="n">dto</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tu</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="s1">&#39;.-&#39;</span><span class="p">)</span>

<span class="n">x2</span><span class="o">=</span><span class="n">delay</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span><span class="o">-</span><span class="n">dto</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tu</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/39a78d69ee0fe8612aba296d0c0b1e24624a6e9d7f1f67418a88b7c7787198dc.png" src="../_images/39a78d69ee0fe8612aba296d0c0b1e24624a6e9d7f1f67418a88b7c7787198dc.png" />
</div>
</div>
<p>Simulate the multi channel acoustic measurements using franctional delay</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">te</span><span class="o">=</span><span class="mi">150</span> <span class="c1"># ms</span>
<span class="n">tx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">te</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>

<span class="n">nh</span><span class="o">=</span><span class="mi">6</span>
<span class="n">ndat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>

<span class="n">tj1</span><span class="o">=</span><span class="p">(</span><span class="n">DT1</span><span class="o">*</span><span class="n">fs</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">DT1</span><span class="o">*</span><span class="n">fs</span><span class="p">))</span>
<span class="n">tj2</span><span class="o">=</span><span class="p">((</span><span class="n">dt</span><span class="o">+</span><span class="n">DT2</span><span class="p">)</span><span class="o">*</span><span class="n">fs</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">dt</span><span class="o">+</span><span class="n">DT2</span><span class="p">)</span><span class="o">*</span><span class="n">fs</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">DT1</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">DT2</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">j1</span><span class="o">=</span><span class="mi">200</span>
<span class="n">j2</span><span class="o">=</span><span class="n">j1</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">dt</span><span class="o">+</span><span class="n">DT2</span><span class="p">)</span><span class="o">*</span><span class="n">fs</span><span class="p">))</span>
<span class="n">DT2x</span><span class="o">=</span><span class="p">((</span><span class="n">dt</span><span class="o">+</span><span class="n">DT2</span><span class="p">)</span><span class="o">*</span><span class="n">fs</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">j1</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span>
<span class="nb">print</span><span class="p">(</span><span class="n">j2</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">DT2x</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">j3</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">fs</span>
<span class="n">fo</span><span class="o">=</span><span class="mi">8</span>
<span class="n">rr</span><span class="o">=</span><span class="mi">0</span><span class="o">*</span><span class="n">uu</span>
<span class="n">rr</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">10</span><span class="o">+</span><span class="mi">95</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">95</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="o">*</span><span class="n">fo</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">ju</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">uu</span><span class="p">)</span>
<span class="n">xx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ndat</span><span class="p">,</span><span class="n">nh</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nh</span><span class="p">):</span>
    <span class="n">xx</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tx</span><span class="p">))</span>
    <span class="n">xx</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j1</span><span class="o">+</span><span class="n">ju</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span><span class="n">xx</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j1</span><span class="o">+</span><span class="n">ju</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span><span class="n">a1</span><span class="o">*</span><span class="n">delay</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span><span class="n">DT1</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">xx</span><span class="p">[</span><span class="n">j2</span><span class="p">:</span><span class="n">j2</span><span class="o">+</span><span class="n">ju</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span><span class="n">xx</span><span class="p">[</span><span class="n">j2</span><span class="p">:</span><span class="n">j2</span><span class="o">+</span><span class="n">ju</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span><span class="n">a2</span><span class="o">*</span><span class="n">delay</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span><span class="n">DT2x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">xx</span><span class="p">[</span><span class="n">j3</span><span class="p">:</span><span class="n">j3</span><span class="o">+</span><span class="n">ju</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span><span class="n">xx</span><span class="p">[</span><span class="n">j3</span><span class="p">:</span><span class="n">j3</span><span class="o">+</span><span class="n">ju</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span><span class="n">a1</span><span class="o">/</span><span class="mi">10</span><span class="o">*</span><span class="n">delay</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">DT2</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>

<span class="c1"># prepare plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">,[</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="n">xx</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ndat</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">234</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="n">xx</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ndat</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">235</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="n">xx</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ndat</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">236</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="n">xx</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ndat</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">104</span><span class="p">,</span> <span class="mi">108</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 5.32764206 -2.33857115 -2.33857115  2.33857115 -5.32764206  2.33857115]
[ 4.04423938 -3.38863747 -3.38863747  3.38863747 -4.04423938  3.38863747]
105.86979166666667
[ 4.35645551 -3.07642134 -3.07642134  3.7008536  -3.73202325  3.7008536 ]
</pre></div>
</div>
<img alt="../_images/6dc76482450e40e1a3764218bd0f1e2797ce11be3fd879b9af5544ea94a7bcdc.png" src="../_images/6dc76482450e40e1a3764218bd0f1e2797ce11be3fd879b9af5544ea94a7bcdc.png" />
</div>
</div>
<p>process all data channels using spectrogram method</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>

<span class="c1">#ndat=np.shape(xx)[0]</span>
<span class="c1">#nh=6</span>

<span class="n">nw</span><span class="o">=</span><span class="mi">256</span>
<span class="n">nfft</span><span class="o">=</span><span class="n">nw</span>
<span class="n">nf</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">nfft</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">nt</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">ndat</span><span class="o">-</span><span class="n">nw</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nw</span><span class="o">-</span><span class="n">nw</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>

<span class="n">P</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">nt</span><span class="p">,</span><span class="n">nh</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">fp</span><span class="p">,</span><span class="n">tp</span><span class="p">,</span><span class="n">P</span><span class="p">[:,:,</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">signal</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">xx</span><span class="p">[:,</span><span class="n">ii</span><span class="p">],</span><span class="n">fs</span><span class="p">,</span><span class="n">nperseg</span><span class="o">=</span><span class="n">nw</span><span class="p">,</span><span class="n">nfft</span><span class="o">=</span><span class="n">nfft</span><span class="p">,</span><span class="n">boundary</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">P</span><span class="p">))</span>
<span class="n">t_ext</span><span class="o">=</span><span class="p">(</span><span class="n">tp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t_ext</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">M</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">P</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">,[</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">im1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">M</span><span class="p">),</span><span class="n">extent</span><span class="o">=</span><span class="n">t_ext</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>224
(129, 224, 6)
(0.6666666666666666, 149.33333333333334, 0.0, 96.0)
(129, 224)
</pre></div>
</div>
<img alt="../_images/96cafe709a95b9de00a8ba7e66dd43b4f31dbb7a016e31a7d6c057e3483d8158.png" src="../_images/96cafe709a95b9de00a8ba7e66dd43b4f31dbb7a016e31a7d6c057e3483d8158.png" />
</div>
</div>
<p>Cross correlate hydrophone pairs (proportional to complex division)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#cross correlation</span>
<span class="n">M</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">nt</span><span class="p">,</span><span class="n">nc</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
    <span class="n">M</span><span class="p">[:,:,</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">P</span><span class="p">[:,:,</span><span class="n">isel</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">P</span><span class="p">[:,:,</span><span class="n">isel</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>Check sign of cross corelation with delay</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nfft</span><span class="o">=</span><span class="mi">256</span>
<span class="n">ii</span><span class="o">=</span><span class="mi">1</span>
<span class="n">jj</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">ii</span><span class="o">*</span><span class="mi">128</span><span class="p">,</span><span class="n">ii</span><span class="o">*</span><span class="mi">128</span><span class="o">+</span><span class="n">nfft</span><span class="p">)</span>
<span class="n">u0</span><span class="o">=</span><span class="n">xx</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<span class="n">u1</span><span class="o">=</span><span class="n">xx</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span>
<span class="n">vv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span><span class="n">M</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">,[</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vv</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ea14882c248db04dae6061e7c41d458d4e8757aaa8f10769d9327bf756073b3a.png" src="../_images/ea14882c248db04dae6061e7c41d458d4e8757aaa8f10769d9327bf756073b3a.png" />
</div>
</div>
<p>channel 1 (u1) is earlier with respect to channel 0 (u0), so that â€˜delayâ€™ is negative (&gt; nfft/2)</p>
<p>Crosscorrelate all hydrophone pairs for single time step</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">quadInt</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span><span class="n">imx</span><span class="p">,</span><span class="n">nd1</span><span class="p">,</span><span class="n">nc</span><span class="p">):</span>
    <span class="n">ux</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nc</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
        <span class="n">uo</span><span class="o">=</span><span class="n">uu</span><span class="p">[</span><span class="n">imx</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">ii</span><span class="p">]</span>
        <span class="n">um</span><span class="o">=</span><span class="n">uu</span><span class="p">[</span><span class="n">imx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
        <span class="n">up</span><span class="o">=</span><span class="n">uu</span><span class="p">[</span><span class="n">imx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>

        <span class="n">b</span><span class="o">=</span><span class="p">(</span><span class="n">up</span><span class="o">+</span><span class="n">um</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">uo</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

        <span class="n">xo</span><span class="o">=</span><span class="p">(</span><span class="n">um</span><span class="o">-</span><span class="n">up</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">b</span><span class="p">);</span>
        <span class="n">yo</span><span class="o">=</span><span class="n">uo</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">xo</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span>

        <span class="n">xo</span> <span class="o">+=</span> <span class="n">imx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">nd1</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="n">ux</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">xo</span>
        <span class="n">ux</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">yo</span>
    <span class="k">return</span> <span class="n">ux</span>

<span class="n">ii</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">A</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nfft</span><span class="p">,</span><span class="n">nc</span><span class="p">))</span>
<span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
    <span class="n">A</span><span class="p">[:,</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span><span class="n">M</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="n">kk</span><span class="p">]));</span>

<span class="n">imx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">udel</span><span class="o">=</span><span class="n">quadInt</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">imx</span><span class="p">,</span><span class="n">nfft</span><span class="p">,</span><span class="n">nc</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>

<span class="n">sc</span><span class="o">=</span><span class="mf">0.5</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nfft</span><span class="p">)</span><span class="o">-</span><span class="n">nfft</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">A</span><span class="o">*</span><span class="n">sc</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nfft</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">udel</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="n">udel</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">sc</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nc</span><span class="p">),</span><span class="s1">&#39;o&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f5db7be2a623871e726d7e1bdbaf81c66a1a29a6e1ce9e6223aef7c668dcfe10.png" src="../_images/f5db7be2a623871e726d7e1bdbaf81c66a1a29a6e1ce9e6223aef7c668dcfe10.png" />
</div>
</div>
<p>Crosscorrelate over all hydrophone pairs and time steps</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nfft</span><span class="o">=</span><span class="mi">256</span>
<span class="n">nf</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nfft</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ns</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span><span class="o">-</span><span class="n">nfft</span><span class="p">)</span><span class="o">/</span><span class="n">nfft</span><span class="p">)</span>
<span class="n">acor</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ns</span><span class="p">,</span><span class="n">nc</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">acor</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">P</span><span class="p">))</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nfft</span><span class="p">,</span><span class="n">nc</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ns</span><span class="p">):</span>
    <span class="n">io</span><span class="o">=</span><span class="n">ii</span><span class="o">*</span><span class="mi">128</span>
    <span class="n">jj</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="n">io</span><span class="o">+</span><span class="n">nfft</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
            <span class="n">A</span><span class="p">[:,</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span><span class="n">M</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="n">kk</span><span class="p">]));</span>

        <span class="n">imx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">acor</span><span class="p">[</span><span class="n">ii</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">quadInt</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">imx</span><span class="p">,</span><span class="n">nfft</span><span class="p">,</span><span class="n">nc</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">acor</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">acor</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(223, 15, 2)
(129, 224, 6)
</pre></div>
</div>
<img alt="../_images/3f1d52f36fd02b02550a82059b984aafd1eb6ca791ad1d3d0d918ce309bb7434.png" src="../_images/3f1d52f36fd02b02550a82059b984aafd1eb6ca791ad1d3d0d918ce309bb7434.png" />
</div>
</div>
<p>Combine all crosscorrelations to obtain direction vectors</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ns</span><span class="p">):</span>
    <span class="n">B</span><span class="p">[</span><span class="n">ii</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">DI</span><span class="p">,</span><span class="n">acor</span><span class="p">[</span><span class="n">ii</span><span class="p">,:,:])</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">,[</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>

<span class="n">bn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">B</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">iu</span><span class="o">=</span><span class="n">bn</span><span class="o">&lt;</span><span class="mf">1e-5</span>
<span class="n">B</span><span class="p">[</span><span class="n">iu</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">B</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;*--&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">B</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;*--&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">110</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/183408ed71d14b4a8e7ad99672fb571d7983acbe1384c4e8fa3d028a9da3defa.png" src="../_images/183408ed71d14b4a8e7ad99672fb571d7983acbe1384c4e8fa3d028a9da3defa.png" />
</div>
</div>
<p>Estimate signal directions from direction vectors</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">azi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">B</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">B</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">ele</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">B</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">B</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">,[</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">azi</span><span class="p">,</span><span class="s1">&#39;*--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">ele</span><span class="p">,</span><span class="s1">&#39;*--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ele</span><span class="p">[:</span><span class="mi">10</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">ele</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">100</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">ele</span><span class="p">[</span><span class="mi">100</span><span class="p">:]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">el1</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">el2</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">el2</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-3.2904669208611557 14.785478217263059 14.463053137032901
-3.4336303624505224 14.574216198038739 14.574216198038739
</pre></div>
</div>
<img alt="../_images/d360b0f7539aa344a25e0ceb8cc926b2618ca687160f807b6592dfe54ddbced6.png" src="../_images/d360b0f7539aa344a25e0ceb8cc926b2618ca687160f807b6592dfe54ddbced6.png" />
</div>
</div>
<p>Direction finding using sound intensity</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#intensities</span>
<span class="n">I</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
    <span class="n">MI</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">M</span><span class="p">[:,:,</span><span class="n">ii</span><span class="p">])</span>
    <span class="n">I</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">I</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="n">DI</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">MI</span>
    <span class="n">I</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">I</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span> <span class="n">DI</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">MI</span>
    <span class="n">I</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">I</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span> <span class="n">DI</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">MI</span>

<span class="n">I</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="mf">1e-10</span> <span class="c1">#make DC intensity non-zero to avoid inf</span>
<span class="n">I</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="mf">1e-10</span> <span class="c1">#make Nyquist intensity non-zero to avoid inf</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">I</span><span class="p">[:,:,</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">I</span><span class="p">[:,:,</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="n">I</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]</span>

<span class="c1">#</span>
<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">,[</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">411</span><span class="p">)</span>
<span class="n">im1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">I</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]),</span><span class="n">extent</span><span class="o">=</span><span class="n">t_ext</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">150</span><span class="p">,</span><span class="o">-</span><span class="mi">50</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">cb1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">412</span><span class="p">)</span>
<span class="n">im2</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span><span class="n">extent</span><span class="o">=</span><span class="n">t_ext</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">cb2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">413</span><span class="p">)</span>
<span class="n">im3</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">],</span><span class="n">extent</span><span class="o">=</span><span class="n">t_ext</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">cb3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">414</span><span class="p">)</span>
<span class="n">im4</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">],</span><span class="n">extent</span><span class="o">=</span><span class="n">t_ext</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">cb4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im4</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/73c8d761b6991ea9abc72f979382db64bc402912e937d72bf401088272cb545c.png" src="../_images/73c8d761b6991ea9abc72f979382db64bc402912e937d72bf401088272cb545c.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Misc"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-formulation">Basic formulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#angle-estimations">Angle estimations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-delay-based-direction-finding">Time delay based direction finding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#intensity-based-direction-finding">Intensity based direction finding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phase-based-direction-finding">phase based direction finding</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation">Simulation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Walter MX Zimmer
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>